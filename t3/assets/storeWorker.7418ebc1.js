var bt=Object.defineProperty;var At=(C,M,$)=>M in C?bt(C,M,{enumerable:!0,configurable:!0,writable:!0,value:$}):C[M]=$;var w=(C,M,$)=>(At(C,typeof M!="symbol"?M+"":M,$),$);(function(){"use strict";const C=Symbol("Comlink.proxy"),M=Symbol("Comlink.endpoint"),$=Symbol("Comlink.releaseProxy"),j=Symbol("Comlink.thrown"),st=u=>typeof u=="object"&&u!==null||typeof u=="function",ut={canHandle:u=>st(u)&&u[C],serialize(u){const{port1:t,port2:s}=new MessageChannel;return W(u,t),[s,[s]]},deserialize(u){return u.start(),dt(u)}},mt={canHandle:u=>st(u)&&j in u,serialize({value:u}){let t;return u instanceof Error?t={isError:!0,value:{message:u.message,name:u.name,stack:u.stack}}:t={isError:!1,value:u},[t,[]]},deserialize(u){throw u.isError?Object.assign(new Error(u.value.message),u.value):u.value}},et=new Map([["proxy",ut],["throw",mt]]);function W(u,t=self){t.addEventListener("message",function s(e){if(!e||!e.data)return;const{id:n,type:i,path:r}=Object.assign({path:[]},e.data),h=(e.data.argumentList||[]).map(k);let l;try{const o=r.slice(0,-1).reduce((y,c)=>y[c],u),a=r.reduce((y,c)=>y[c],u);switch(i){case"GET":l=a;break;case"SET":o[r.slice(-1)[0]]=k(e.data.value),l=!0;break;case"APPLY":l=a.apply(o,h);break;case"CONSTRUCT":{const y=new a(...h);l=ft(y)}break;case"ENDPOINT":{const{port1:y,port2:c}=new MessageChannel;W(u,c),l=pt(y,[y])}break;case"RELEASE":l=void 0;break;default:return}}catch(o){l={value:o,[j]:0}}Promise.resolve(l).catch(o=>({value:o,[j]:0})).then(o=>{const[a,y]=Q(o);t.postMessage(Object.assign(Object.assign({},a),{id:n}),y),i==="RELEASE"&&(t.removeEventListener("message",s),it(t))})}),t.start&&t.start()}function xt(u){return u.constructor.name==="MessagePort"}function it(u){xt(u)&&u.close()}function dt(u,t){return H(u,[],t)}function V(u){if(u)throw new Error("Proxy has been released and is not useable")}function H(u,t=[],s=function(){}){let e=!1;const n=new Proxy(s,{get(i,r){if(V(e),r===$)return()=>R(u,{type:"RELEASE",path:t.map(h=>h.toString())}).then(()=>{it(u),e=!0});if(r==="then"){if(t.length===0)return{then:()=>n};const h=R(u,{type:"GET",path:t.map(l=>l.toString())}).then(k);return h.then.bind(h)}return H(u,[...t,r])},set(i,r,h){V(e);const[l,o]=Q(h);return R(u,{type:"SET",path:[...t,r].map(a=>a.toString()),value:l},o).then(k)},apply(i,r,h){V(e);const l=t[t.length-1];if(l===M)return R(u,{type:"ENDPOINT"}).then(k);if(l==="bind")return H(u,t.slice(0,-1));const[o,a]=nt(h);return R(u,{type:"APPLY",path:t.map(y=>y.toString()),argumentList:o},a).then(k)},construct(i,r){V(e);const[h,l]=nt(r);return R(u,{type:"CONSTRUCT",path:t.map(o=>o.toString()),argumentList:h},l).then(k)}});return n}function _t(u){return Array.prototype.concat.apply([],u)}function nt(u){const t=u.map(Q);return[t.map(s=>s[0]),_t(t.map(s=>s[1]))]}const rt=new WeakMap;function pt(u,t){return rt.set(u,t),u}function ft(u){return Object.assign(u,{[C]:!0})}function Q(u){for(const[t,s]of et)if(s.canHandle(u)){const[e,n]=s.serialize(u);return[{type:"HANDLER",name:t,value:e},n]}return[{type:"RAW",value:u},rt.get(u)||[]]}function k(u){switch(u.type){case"HANDLER":return et.get(u.name).deserialize(u.value);case"RAW":return u.value}}function R(u,t,s){return new Promise(e=>{const n=gt();u.addEventListener("message",function i(r){!r.data||!r.data.id||r.data.id!==n||(u.removeEventListener("message",i),e(r.data))}),u.start&&u.start(),u.postMessage(Object.assign({id:n},t),s)})}function gt(){return new Array(4).fill(0).map(()=>Math.floor(Math.random()*Number.MAX_SAFE_INTEGER).toString(16)).join("-")}function at(u){if(u)return u.projectKey;throw"getActiveProjectModelGroupKey called without active prosjekt selected"}function ht(u){return`META_${u}`}class O{constructor(t,s=1,e="DATA"){w(this,"__name");w(this,"__version");w(this,"__storeName");w(this,"__logEnabled");w(this,"__db");this.__name=t,this.__version=s,this.__storeName=e,this.__logEnabled=!1}enableLog(){this.__logEnabled=!0}__logStart(t){this.__logEnabled&&console.time(`ModelStoreLog_${this.__name}_${this.__storeName}_${t}`)}__logEnd(t){this.__logEnabled&&console.timeEnd(`ModelStoreLog_${this.__name}_${this.__storeName}_${t}`)}close(){return new Promise(t=>{this.__db&&(this.__db.close(),t(!0))})}__open(){return new Promise((t,s)=>{if(this.__db)t(this.__db);else{const e=indexedDB.open(this.__name,this.__version);e.onupgradeneeded=()=>{const n=e.result;n.objectStoreNames.contains(this.__name)||n.createObjectStore(this.__storeName)},e.onblocked=n=>{this.__logEnd("getKey"),s({type:"onblocked",event:n})},e.onerror=n=>{this.__logEnd("getKey"),s({type:"onblocked",event:n})},e.onsuccess=()=>{this.__db=e.result,t(e.result)}}})}getUUID(){return crypto.randomUUID()}getKey(t){return new Promise(async(s,e)=>{this.__logStart("getKey");try{const i=(await this.__open()).transaction(this.__storeName);i.onerror=l=>{this.__logEnd("getKey"),e({type:"store tx error",event:l})};const h=i.objectStore(this.__storeName).get(t);h.onsuccess=()=>{this.__logEnd("getKey"),s(h.result)}}catch(n){this.__logEnd("getKey"),e(n)}})}setKey(t,s){return new Promise(async(e,n)=>{var i;this.__logStart("setKey");try{const h=(await this.__open()).transaction(this.__storeName,"readwrite");h.onerror=a=>{this.__logEnd("setKey"),n({type:"store tx error",event:a})};const o=h.objectStore(this.__storeName).put(s,t);o.onsuccess=()=>{this.__logEnd("setKey"),e(o.result)},(i=o.transaction)==null||i.commit()}catch(r){this.__logEnd("setKey"),n(r)}})}getAllKeys(){return new Promise(async(t,s)=>{this.__logStart("getAllKeys");try{const n=(await this.__open()).transaction(this.__storeName,"readwrite");n.onerror=h=>{this.__logEnd("getAllKeys"),s({type:"store tx error",event:h})};const r=n.objectStore(this.__storeName).getAllKeys();r.onsuccess=()=>{this.__logEnd("getAllKeys"),t(r.result)}}catch(e){this.__logEnd("getAllKeys"),s(e)}})}deleteKey(t){return new Promise(async(s,e)=>{this.__logStart("deleteKey");try{const i=(await this.__open()).transaction(this.__storeName,"readwrite");i.onerror=l=>{this.__logEnd("deleteKey"),e({type:"store tx error",event:l})};const h=i.objectStore(this.__storeName).delete(t);h.onsuccess=()=>{this.__logEnd("deleteKey"),s(h.result)}}catch(n){this.__logEnd("deleteKey"),e(n)}})}deleteDB(){return new Promise((t,s)=>{this.__logStart("deleteDB");const e=indexedDB.deleteDatabase(this.__name);e.onsuccess=()=>{this.__logEnd("deleteDB"),t(!0)},e.onerror=n=>{this.__logEnd("deleteDB"),s({type:"onblocked",event:n})}})}}/**
 * @license
 * Copyright 2010-2022 Three.js Authors
 * SPDX-License-Identifier: MIT
 */const ot="145";function lt(u,t,s){return Math.max(t,Math.min(s,u))}class zt{constructor(t=0,s=0,e=0,n=1){this.isQuaternion=!0,this._x=t,this._y=s,this._z=e,this._w=n}static slerpFlat(t,s,e,n,i,r,h){let l=e[n+0],o=e[n+1],a=e[n+2],y=e[n+3];const c=i[r+0],m=i[r+1],x=i[r+2],_=i[r+3];if(h===0){t[s+0]=l,t[s+1]=o,t[s+2]=a,t[s+3]=y;return}if(h===1){t[s+0]=c,t[s+1]=m,t[s+2]=x,t[s+3]=_;return}if(y!==_||l!==c||o!==m||a!==x){let d=1-h;const f=l*c+o*m+a*x+y*_,z=f>=0?1:-1,T=1-f*f;if(T>Number.EPSILON){const g=Math.sqrt(T),Z=Math.atan2(g,f*z);d=Math.sin(d*Z)/g,h=Math.sin(h*Z)/g}const A=h*z;if(l=l*d+c*A,o=o*d+m*A,a=a*d+x*A,y=y*d+_*A,d===1-h){const g=1/Math.sqrt(l*l+o*o+a*a+y*y);l*=g,o*=g,a*=g,y*=g}}t[s]=l,t[s+1]=o,t[s+2]=a,t[s+3]=y}static multiplyQuaternionsFlat(t,s,e,n,i,r){const h=e[n],l=e[n+1],o=e[n+2],a=e[n+3],y=i[r],c=i[r+1],m=i[r+2],x=i[r+3];return t[s]=h*x+a*y+l*m-o*c,t[s+1]=l*x+a*c+o*y-h*m,t[s+2]=o*x+a*m+h*c-l*y,t[s+3]=a*x-h*y-l*c-o*m,t}get x(){return this._x}set x(t){this._x=t,this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t,this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t,this._onChangeCallback()}get w(){return this._w}set w(t){this._w=t,this._onChangeCallback()}set(t,s,e,n){return this._x=t,this._y=s,this._z=e,this._w=n,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(t){return this._x=t.x,this._y=t.y,this._z=t.z,this._w=t.w,this._onChangeCallback(),this}setFromEuler(t,s){const e=t._x,n=t._y,i=t._z,r=t._order,h=Math.cos,l=Math.sin,o=h(e/2),a=h(n/2),y=h(i/2),c=l(e/2),m=l(n/2),x=l(i/2);switch(r){case"XYZ":this._x=c*a*y+o*m*x,this._y=o*m*y-c*a*x,this._z=o*a*x+c*m*y,this._w=o*a*y-c*m*x;break;case"YXZ":this._x=c*a*y+o*m*x,this._y=o*m*y-c*a*x,this._z=o*a*x-c*m*y,this._w=o*a*y+c*m*x;break;case"ZXY":this._x=c*a*y-o*m*x,this._y=o*m*y+c*a*x,this._z=o*a*x+c*m*y,this._w=o*a*y-c*m*x;break;case"ZYX":this._x=c*a*y-o*m*x,this._y=o*m*y+c*a*x,this._z=o*a*x-c*m*y,this._w=o*a*y+c*m*x;break;case"YZX":this._x=c*a*y+o*m*x,this._y=o*m*y+c*a*x,this._z=o*a*x-c*m*y,this._w=o*a*y-c*m*x;break;case"XZY":this._x=c*a*y-o*m*x,this._y=o*m*y-c*a*x,this._z=o*a*x+c*m*y,this._w=o*a*y+c*m*x;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+r)}return s!==!1&&this._onChangeCallback(),this}setFromAxisAngle(t,s){const e=s/2,n=Math.sin(e);return this._x=t.x*n,this._y=t.y*n,this._z=t.z*n,this._w=Math.cos(e),this._onChangeCallback(),this}setFromRotationMatrix(t){const s=t.elements,e=s[0],n=s[4],i=s[8],r=s[1],h=s[5],l=s[9],o=s[2],a=s[6],y=s[10],c=e+h+y;if(c>0){const m=.5/Math.sqrt(c+1);this._w=.25/m,this._x=(a-l)*m,this._y=(i-o)*m,this._z=(r-n)*m}else if(e>h&&e>y){const m=2*Math.sqrt(1+e-h-y);this._w=(a-l)/m,this._x=.25*m,this._y=(n+r)/m,this._z=(i+o)/m}else if(h>y){const m=2*Math.sqrt(1+h-e-y);this._w=(i-o)/m,this._x=(n+r)/m,this._y=.25*m,this._z=(l+a)/m}else{const m=2*Math.sqrt(1+y-e-h);this._w=(r-n)/m,this._x=(i+o)/m,this._y=(l+a)/m,this._z=.25*m}return this._onChangeCallback(),this}setFromUnitVectors(t,s){let e=t.dot(s)+1;return e<Number.EPSILON?(e=0,Math.abs(t.x)>Math.abs(t.z)?(this._x=-t.y,this._y=t.x,this._z=0,this._w=e):(this._x=0,this._y=-t.z,this._z=t.y,this._w=e)):(this._x=t.y*s.z-t.z*s.y,this._y=t.z*s.x-t.x*s.z,this._z=t.x*s.y-t.y*s.x,this._w=e),this.normalize()}angleTo(t){return 2*Math.acos(Math.abs(lt(this.dot(t),-1,1)))}rotateTowards(t,s){const e=this.angleTo(t);if(e===0)return this;const n=Math.min(1,s/e);return this.slerp(t,n),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(t){return this._x*t._x+this._y*t._y+this._z*t._z+this._w*t._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let t=this.length();return t===0?(this._x=0,this._y=0,this._z=0,this._w=1):(t=1/t,this._x=this._x*t,this._y=this._y*t,this._z=this._z*t,this._w=this._w*t),this._onChangeCallback(),this}multiply(t){return this.multiplyQuaternions(this,t)}premultiply(t){return this.multiplyQuaternions(t,this)}multiplyQuaternions(t,s){const e=t._x,n=t._y,i=t._z,r=t._w,h=s._x,l=s._y,o=s._z,a=s._w;return this._x=e*a+r*h+n*o-i*l,this._y=n*a+r*l+i*h-e*o,this._z=i*a+r*o+e*l-n*h,this._w=r*a-e*h-n*l-i*o,this._onChangeCallback(),this}slerp(t,s){if(s===0)return this;if(s===1)return this.copy(t);const e=this._x,n=this._y,i=this._z,r=this._w;let h=r*t._w+e*t._x+n*t._y+i*t._z;if(h<0?(this._w=-t._w,this._x=-t._x,this._y=-t._y,this._z=-t._z,h=-h):this.copy(t),h>=1)return this._w=r,this._x=e,this._y=n,this._z=i,this;const l=1-h*h;if(l<=Number.EPSILON){const m=1-s;return this._w=m*r+s*this._w,this._x=m*e+s*this._x,this._y=m*n+s*this._y,this._z=m*i+s*this._z,this.normalize(),this._onChangeCallback(),this}const o=Math.sqrt(l),a=Math.atan2(o,h),y=Math.sin((1-s)*a)/o,c=Math.sin(s*a)/o;return this._w=r*y+this._w*c,this._x=e*y+this._x*c,this._y=n*y+this._y*c,this._z=i*y+this._z*c,this._onChangeCallback(),this}slerpQuaternions(t,s,e){return this.copy(t).slerp(s,e)}random(){const t=Math.random(),s=Math.sqrt(1-t),e=Math.sqrt(t),n=2*Math.PI*Math.random(),i=2*Math.PI*Math.random();return this.set(s*Math.cos(n),e*Math.sin(i),e*Math.cos(i),s*Math.sin(n))}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._w===this._w}fromArray(t,s=0){return this._x=t[s],this._y=t[s+1],this._z=t[s+2],this._w=t[s+3],this._onChangeCallback(),this}toArray(t=[],s=0){return t[s]=this._x,t[s+1]=this._y,t[s+2]=this._z,t[s+3]=this._w,t}fromBufferAttribute(t,s){return this._x=t.getX(s),this._y=t.getY(s),this._z=t.getZ(s),this._w=t.getW(s),this}_onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}class p{constructor(t=0,s=0,e=0){p.prototype.isVector3=!0,this.x=t,this.y=s,this.z=e}set(t,s,e){return e===void 0&&(e=this.z),this.x=t,this.y=s,this.z=e,this}setScalar(t){return this.x=t,this.y=t,this.z=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setZ(t){return this.z=t,this}setComponent(t,s){switch(t){case 0:this.x=s;break;case 1:this.y=s;break;case 2:this.z=s;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this}add(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this}addScalar(t){return this.x+=t,this.y+=t,this.z+=t,this}addVectors(t,s){return this.x=t.x+s.x,this.y=t.y+s.y,this.z=t.z+s.z,this}addScaledVector(t,s){return this.x+=t.x*s,this.y+=t.y*s,this.z+=t.z*s,this}sub(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this}subScalar(t){return this.x-=t,this.y-=t,this.z-=t,this}subVectors(t,s){return this.x=t.x-s.x,this.y=t.y-s.y,this.z=t.z-s.z,this}multiply(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this}multiplyScalar(t){return this.x*=t,this.y*=t,this.z*=t,this}multiplyVectors(t,s){return this.x=t.x*s.x,this.y=t.y*s.y,this.z=t.z*s.z,this}applyEuler(t){return this.applyQuaternion(ct.setFromEuler(t))}applyAxisAngle(t,s){return this.applyQuaternion(ct.setFromAxisAngle(t,s))}applyMatrix3(t){const s=this.x,e=this.y,n=this.z,i=t.elements;return this.x=i[0]*s+i[3]*e+i[6]*n,this.y=i[1]*s+i[4]*e+i[7]*n,this.z=i[2]*s+i[5]*e+i[8]*n,this}applyNormalMatrix(t){return this.applyMatrix3(t).normalize()}applyMatrix4(t){const s=this.x,e=this.y,n=this.z,i=t.elements,r=1/(i[3]*s+i[7]*e+i[11]*n+i[15]);return this.x=(i[0]*s+i[4]*e+i[8]*n+i[12])*r,this.y=(i[1]*s+i[5]*e+i[9]*n+i[13])*r,this.z=(i[2]*s+i[6]*e+i[10]*n+i[14])*r,this}applyQuaternion(t){const s=this.x,e=this.y,n=this.z,i=t.x,r=t.y,h=t.z,l=t.w,o=l*s+r*n-h*e,a=l*e+h*s-i*n,y=l*n+i*e-r*s,c=-i*s-r*e-h*n;return this.x=o*l+c*-i+a*-h-y*-r,this.y=a*l+c*-r+y*-i-o*-h,this.z=y*l+c*-h+o*-r-a*-i,this}project(t){return this.applyMatrix4(t.matrixWorldInverse).applyMatrix4(t.projectionMatrix)}unproject(t){return this.applyMatrix4(t.projectionMatrixInverse).applyMatrix4(t.matrixWorld)}transformDirection(t){const s=this.x,e=this.y,n=this.z,i=t.elements;return this.x=i[0]*s+i[4]*e+i[8]*n,this.y=i[1]*s+i[5]*e+i[9]*n,this.z=i[2]*s+i[6]*e+i[10]*n,this.normalize()}divide(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this}divideScalar(t){return this.multiplyScalar(1/t)}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this}clamp(t,s){return this.x=Math.max(t.x,Math.min(s.x,this.x)),this.y=Math.max(t.y,Math.min(s.y,this.y)),this.z=Math.max(t.z,Math.min(s.z,this.z)),this}clampScalar(t,s){return this.x=Math.max(t,Math.min(s,this.x)),this.y=Math.max(t,Math.min(s,this.y)),this.z=Math.max(t,Math.min(s,this.z)),this}clampLength(t,s){const e=this.length();return this.divideScalar(e||1).multiplyScalar(Math.max(t,Math.min(s,e)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,s){return this.x+=(t.x-this.x)*s,this.y+=(t.y-this.y)*s,this.z+=(t.z-this.z)*s,this}lerpVectors(t,s,e){return this.x=t.x+(s.x-t.x)*e,this.y=t.y+(s.y-t.y)*e,this.z=t.z+(s.z-t.z)*e,this}cross(t){return this.crossVectors(this,t)}crossVectors(t,s){const e=t.x,n=t.y,i=t.z,r=s.x,h=s.y,l=s.z;return this.x=n*l-i*h,this.y=i*r-e*l,this.z=e*h-n*r,this}projectOnVector(t){const s=t.lengthSq();if(s===0)return this.set(0,0,0);const e=t.dot(this)/s;return this.copy(t).multiplyScalar(e)}projectOnPlane(t){return G.copy(this).projectOnVector(t),this.sub(G)}reflect(t){return this.sub(G.copy(t).multiplyScalar(2*this.dot(t)))}angleTo(t){const s=Math.sqrt(this.lengthSq()*t.lengthSq());if(s===0)return Math.PI/2;const e=this.dot(t)/s;return Math.acos(lt(e,-1,1))}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){const s=this.x-t.x,e=this.y-t.y,n=this.z-t.z;return s*s+e*e+n*n}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)+Math.abs(this.z-t.z)}setFromSpherical(t){return this.setFromSphericalCoords(t.radius,t.phi,t.theta)}setFromSphericalCoords(t,s,e){const n=Math.sin(s)*t;return this.x=n*Math.sin(e),this.y=Math.cos(s)*t,this.z=n*Math.cos(e),this}setFromCylindrical(t){return this.setFromCylindricalCoords(t.radius,t.theta,t.y)}setFromCylindricalCoords(t,s,e){return this.x=t*Math.sin(s),this.y=e,this.z=t*Math.cos(s),this}setFromMatrixPosition(t){const s=t.elements;return this.x=s[12],this.y=s[13],this.z=s[14],this}setFromMatrixScale(t){const s=this.setFromMatrixColumn(t,0).length(),e=this.setFromMatrixColumn(t,1).length(),n=this.setFromMatrixColumn(t,2).length();return this.x=s,this.y=e,this.z=n,this}setFromMatrixColumn(t,s){return this.fromArray(t.elements,s*4)}setFromMatrix3Column(t,s){return this.fromArray(t.elements,s*3)}setFromEuler(t){return this.x=t._x,this.y=t._y,this.z=t._z,this}equals(t){return t.x===this.x&&t.y===this.y&&t.z===this.z}fromArray(t,s=0){return this.x=t[s],this.y=t[s+1],this.z=t[s+2],this}toArray(t=[],s=0){return t[s]=this.x,t[s+1]=this.y,t[s+2]=this.z,t}fromBufferAttribute(t,s){return this.x=t.getX(s),this.y=t.getY(s),this.z=t.getZ(s),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const t=(Math.random()-.5)*2,s=Math.random()*Math.PI*2,e=Math.sqrt(1-t**2);return this.x=e*Math.cos(s),this.y=e*Math.sin(s),this.z=t,this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const G=new p,ct=new zt;class J{constructor(t=new p(1/0,1/0,1/0),s=new p(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=t,this.max=s}set(t,s){return this.min.copy(t),this.max.copy(s),this}setFromArray(t){let s=1/0,e=1/0,n=1/0,i=-1/0,r=-1/0,h=-1/0;for(let l=0,o=t.length;l<o;l+=3){const a=t[l],y=t[l+1],c=t[l+2];a<s&&(s=a),y<e&&(e=y),c<n&&(n=c),a>i&&(i=a),y>r&&(r=y),c>h&&(h=c)}return this.min.set(s,e,n),this.max.set(i,r,h),this}setFromBufferAttribute(t){let s=1/0,e=1/0,n=1/0,i=-1/0,r=-1/0,h=-1/0;for(let l=0,o=t.count;l<o;l++){const a=t.getX(l),y=t.getY(l),c=t.getZ(l);a<s&&(s=a),y<e&&(e=y),c<n&&(n=c),a>i&&(i=a),y>r&&(r=y),c>h&&(h=c)}return this.min.set(s,e,n),this.max.set(i,r,h),this}setFromPoints(t){this.makeEmpty();for(let s=0,e=t.length;s<e;s++)this.expandByPoint(t[s]);return this}setFromCenterAndSize(t,s){const e=N.copy(s).multiplyScalar(.5);return this.min.copy(t).sub(e),this.max.copy(t).add(e),this}setFromObject(t,s=!1){return this.makeEmpty(),this.expandByObject(t,s)}clone(){return new this.constructor().copy(this)}copy(t){return this.min.copy(t.min),this.max.copy(t.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(t){return this.isEmpty()?t.set(0,0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(t){return this.isEmpty()?t.set(0,0,0):t.subVectors(this.max,this.min)}expandByPoint(t){return this.min.min(t),this.max.max(t),this}expandByVector(t){return this.min.sub(t),this.max.add(t),this}expandByScalar(t){return this.min.addScalar(-t),this.max.addScalar(t),this}expandByObject(t,s=!1){t.updateWorldMatrix(!1,!1);const e=t.geometry;if(e!==void 0)if(s&&e.attributes!=null&&e.attributes.position!==void 0){const i=e.attributes.position;for(let r=0,h=i.count;r<h;r++)N.fromBufferAttribute(i,r).applyMatrix4(t.matrixWorld),this.expandByPoint(N)}else e.boundingBox===null&&e.computeBoundingBox(),v.copy(e.boundingBox),v.applyMatrix4(t.matrixWorld),this.union(v);const n=t.children;for(let i=0,r=n.length;i<r;i++)this.expandByObject(n[i],s);return this}containsPoint(t){return!(t.x<this.min.x||t.x>this.max.x||t.y<this.min.y||t.y>this.max.y||t.z<this.min.z||t.z>this.max.z)}containsBox(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y&&this.min.z<=t.min.z&&t.max.z<=this.max.z}getParameter(t,s){return s.set((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y),(t.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(t){return!(t.max.x<this.min.x||t.min.x>this.max.x||t.max.y<this.min.y||t.min.y>this.max.y||t.max.z<this.min.z||t.min.z>this.max.z)}intersectsSphere(t){return this.clampPoint(t.center,N),N.distanceToSquared(t.center)<=t.radius*t.radius}intersectsPlane(t){let s,e;return t.normal.x>0?(s=t.normal.x*this.min.x,e=t.normal.x*this.max.x):(s=t.normal.x*this.max.x,e=t.normal.x*this.min.x),t.normal.y>0?(s+=t.normal.y*this.min.y,e+=t.normal.y*this.max.y):(s+=t.normal.y*this.max.y,e+=t.normal.y*this.min.y),t.normal.z>0?(s+=t.normal.z*this.min.z,e+=t.normal.z*this.max.z):(s+=t.normal.z*this.max.z,e+=t.normal.z*this.min.z),s<=-t.constant&&e>=-t.constant}intersectsTriangle(t){if(this.isEmpty())return!1;this.getCenter(L),X.subVectors(this.max,L),B.subVectors(t.a,L),F.subVectors(t.b,L),q.subVectors(t.c,L),S.subVectors(F,B),b.subVectors(q,F),U.subVectors(B,q);let s=[0,-S.z,S.y,0,-b.z,b.y,0,-U.z,U.y,S.z,0,-S.x,b.z,0,-b.x,U.z,0,-U.x,-S.y,S.x,0,-b.y,b.x,0,-U.y,U.x,0];return!tt(s,B,F,q,X)||(s=[1,0,0,0,1,0,0,0,1],!tt(s,B,F,q,X))?!1:(Y.crossVectors(S,b),s=[Y.x,Y.y,Y.z],tt(s,B,F,q,X))}clampPoint(t,s){return s.copy(t).clamp(this.min,this.max)}distanceToPoint(t){return N.copy(t).clamp(this.min,this.max).sub(t).length()}getBoundingSphere(t){return this.getCenter(t.center),t.radius=this.getSize(N).length()*.5,t}intersect(t){return this.min.max(t.min),this.max.min(t.max),this.isEmpty()&&this.makeEmpty(),this}union(t){return this.min.min(t.min),this.max.max(t.max),this}applyMatrix4(t){return this.isEmpty()?this:(E[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(t),E[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(t),E[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(t),E[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(t),E[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(t),E[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(t),E[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(t),E[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(t),this.setFromPoints(E),this)}translate(t){return this.min.add(t),this.max.add(t),this}equals(t){return t.min.equals(this.min)&&t.max.equals(this.max)}}const E=[new p,new p,new p,new p,new p,new p,new p,new p],N=new p,v=new J,B=new p,F=new p,q=new p,S=new p,b=new p,U=new p,L=new p,X=new p,Y=new p,K=new p;function tt(u,t,s,e,n){for(let i=0,r=u.length-3;i<=r;i+=3){K.fromArray(u,i);const h=n.x*Math.abs(K.x)+n.y*Math.abs(K.y)+n.z*Math.abs(K.z),l=t.dot(K),o=s.dot(K),a=e.dot(K);if(Math.max(-Math.max(l,o,a),Math.min(l,o,a))>h)return!1}return!0}typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:ot}})),typeof window<"u"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=ot);function wt(u){return((u==null?void 0:u.projectKey)||"unknown")+"_TEMP"}class Mt{constructor(){w(this,"$allIds",new Map);w(this,"$rootIdMap",{});w(this,"$fullnameUppercase_ID",new Map);w(this,"$rootFullname",{});w(this,"$threeviewRows",[]);w(this,"$fullNameUppercaseBoundingbox",{});w(this,"$fullNameExpanded",new Set)}async filterFullname(t,s=0){const e=Array.from(this.$fullnameUppercase_ID.keys());let n=t.toUpperCase();if(!t)return[[],0];let i=!1;t[0]==="*"&&(i=!0);let r=!1;if(t[t.length-1]==="*"&&(r=!0),n.split("*").filter(o=>o!=="").length>1)return[["WILDCARD ONLY SUPPORTED IN THE START/END"],0];n=n.replaceAll("*","");const l=[];for(let o=s;o<e.length;o++){const a=e[o]||"";switch(!0){case(i&&r):a.includes(n)&&l.push(a);break;case i:a.endsWith(n)&&l.push(a);break;case r:a.startsWith(n)&&l.push(a);break;default:a===n&&l.push(a)}if(l.length>4)return[l,o]}return[l,0]}async getBoundingBoxFromName(t){const s=new Set;this.addChildrenToSet(s,t);const e={};return s.forEach(n=>{const i=this.$fullNameUppercaseBoundingbox[n.toUpperCase()];i&&(e!=null&&e.X||(e.X=i.X,e.Y=i.Y,e.Z=i.Z,e.x=i.x,e.y=i.y,e.z=i.z),e.X<i.X&&(e.X=i.X),e.Y<i.Y&&(e.Y=i.Y),e.Z<i.Z&&(e.Z=i.Z),e.x>i.x&&(e.x=i.x),e.y>i.y&&(e.y=i.y),e.z>i.z&&(e.z=i.z))}),e}async getBoundingBoxFromKeys(t){const s=new Set;t.forEach(n=>{var i;return s.add(((i=this.$allIds.get(n))==null?void 0:i[0])||"not found...")});const e={};return s.forEach(n=>{const i=this.$fullNameUppercaseBoundingbox[n.toUpperCase()];i&&(e!=null&&e.X||(e.X=i.X,e.Y=i.Y,e.Z=i.Z,e.x=i.x,e.y=i.y,e.z=i.z),e.X<i.X&&(e.X=i.X),e.Y<i.Y&&(e.Y=i.Y),e.Z<i.Z&&(e.Z=i.Z),e.x>i.x&&(e.x=i.x),e.y>i.y&&(e.y=i.y),e.z>i.z&&(e.z=i.z))}),e}async updateMeta(t,s){const e=t==null?void 0:t.filter(i=>i.synced),n=new O(at(s));if(e!=null&&e.length){const i=e.map(o=>o.name),r=new O(wt(s)),h=await r.getKey("dataStoreMetaData")||new Map,l=h.size>0;for(let o=0;o<i.length;o++){let a;l?a=h.get(i[o]):(a=await n.getKey(ht(i[o])),h.set(i[o],structuredClone(a)));const y=a.meta,c=a.bbox;if(c?Object.keys(c).forEach(x=>{this.$fullNameUppercaseBoundingbox[x.toUpperCase()]=c[x]}):console.log(ht(i[o]),"missing"),y){const m=new Map;Object.keys(y).forEach(_=>{m.set(_,y[_]),this.$allIds.set(_,y[_])}),this.traverseMeta(m,i[o])}}l||await r.setKey("dataStoreMetaData",h)}}async removeKeys(t){t.forEach(s=>{var n;const e=(n=this.$allIds.get(s))==null?void 0:n[1];if(e){const i=this.$allIds.get(e);if(Array.isArray(i)){const r=i[2],h=r.indexOf(s);h!==-1&&(r.splice(h,1),i[2]=r)}}})}async getKeyChildrenFromItem(t){const s=[],e=this.$allIds.get(t);if(Array.isArray(e)){const n=e[2];n&&s.push(...n);const i=(r,h)=>{Array.isArray(r)&&r.forEach(l=>{const o=this.$allIds.get(l);if(o){const a=o[2];a&&s.push(...a);const y=o[2];i(y)}})};i(n,this.$threeviewRows)}return s}getKeyChildrenFromItemSync(t){const s=[],e=this.$allIds.get(t);if(Array.isArray(e)){const n=e[2];n&&s.push(...n);const i=(r,h)=>{Array.isArray(r)&&r.forEach(l=>{const o=this.$allIds.get(l);if(o){const a=o[2];a&&s.push(...a);const y=o[2];i(y)}})};i(n,this.$threeviewRows)}return s}async clear(){this.$rootIdMap={},this.$allIds=new Map,this.$threeviewRows=[],this.$rootFullname={},this.$fullNameExpanded=new Set}traverseMeta(t,s){let e=!0;t.forEach(([n,i],r)=>{if(i==="*")e=!1,this.$rootIdMap[r]=t,this.$rootFullname[n]={RootName:s,id:r},this.$fullnameUppercase_ID.set(n.toUpperCase(),r);else{this.$fullnameUppercase_ID.set(n.toUpperCase(),r);const h=t.get(i);if(!h)console.error("parent not found, <id> <name> <parentID>",r,n,i);else{const l=h[2]||[];l.push(r),h.length===2&&(h.push(l),h.push(!1))}}}),e&&console.log("toplevel missing",t)}async length(){return this.$threeviewRows.length}async collaseAll(){this.$fullNameExpanded.forEach(t=>{const s=this.$allIds.get(t);Array.isArray(s)&&(s[3]=!1)}),this.$fullNameExpanded.clear()}async resetRows(){const t=Object.keys(this.$rootIdMap),s=[];t.forEach(e=>{const i=this.$rootIdMap[e].get(e);i&&s.push({key:e,name:i[0]})}),s.sort((e,n)=>e.name<n.name?-1:1),this.$threeviewRows=[],s.forEach(e=>{const n=e.key,i=0,r=this.$rootIdMap[n],h=r.get(n);if(this.$threeviewRows.push({key:n,lvl:i}),Array.isArray(h)){let l=function(y,c,m){if(Array.isArray(y)){const x=m+1;y.forEach(_=>{c.push({key:_,lvl:x});const d=r.get(_);if(d){const f=d[2];d[3]&&l(f,c,x)}})}};const o=h[2];h[3]&&l(o,this.$threeviewRows,i)}})}async getIDsFromFullName(t){const s=[];return t.forEach(e=>{const n=this.$fullnameUppercase_ID.get(e.toUpperCase());n&&s.push(n)}),s}async getIDFromFullName(t){return this.$fullnameUppercase_ID.get(t.toUpperCase())}async getAllKeysFromFullnames(t){const s=[];return t.forEach(e=>{const n=this.$fullnameUppercase_ID.get(e.toUpperCase());n&&(s.push(n),this.getKeyChildrenFromItemSync(n).forEach(i=>{s.push(i)}))}),s}async getFullnameFromKeys(t){const s=[];return t.forEach(e=>{const n=this.$allIds.get(e);Array.isArray(n)&&s.push(n[0])}),s}async getRowsWithfullname(){const t=[];return this.$threeviewRows.forEach(s=>{const e=this.$allIds.get(s.key);t.push({key:s.key,lvl:s.lvl,data:e})}),t}async getData(t){return this.$allIds.get(t)}async getDataExt(t){const s=this.$allIds.get(t);if(Array.isArray(s)){const e=this.getParentsFromName(s[0]);return{fullname:s[0],key:t,parents:e}}else return{fullname:void 0,parents:void 0,key:t}}async toggelExpand(t){const s=this.$allIds.get(t);if(s){const e=s[3];e!==void 0&&(s[3]=!e,s[3]===!0?this.$fullNameExpanded.add(s[1]):this.$fullNameExpanded.delete(s[1]),await this.resetRows())}}async expandLevelsFromID(t){if(t){let s=["",t,[],!1];for(;s&&s[1]!=="*"&&(s=this.$allIds.get(s[1]),!!s);)s[3]=!0,this.$fullNameExpanded.add(s[1]);await this.resetRows()}}getParentsFromName(t){const s=this.$fullnameUppercase_ID.get(t.toUpperCase()),e=new Set;if(s){let n=["",s,[],!1];for(;n&&n[1]!=="*"&&(n=this.$allIds.get(n[1]),!!n);)e.add(n[0])}return Array.from(e)}async getRootFromID(t){if(t){let s=["x",t,[],!1];if(s){for(;s&&s[1]!=="*";)s=this.$allIds.get(s[1]);if(s)return this.$rootFullname[s[0]].RootName}}}getRootFromIDInternal(t){if(t){let s=["x",t,[],!1];for(;s&&s[1]!=="*";)s=this.$allIds.get(s[1]);if(s)return this.$rootFullname[s[0]].RootName}}async getSelectionObjectFromKey(t,s,e){const n=this.getRootFromIDInternal(t);if(Array.isArray(s)&&n&&e){const i=s.filter(r=>r.name===n&&r.$loaded)[0];if(i){const r=at(e),h=new O(r),l=await h.getKey(i.name);let o=null,a=null,y=null;if(Array.isArray(l))for(let c=0;c<l.length;c++){const m=l[c],x=await h.getKey(m);if(x!=null&&x.id_sequence&&(o=x.id_sequence[t],o)){a=x.id_sequence[t],y=x.IdMapString;break}}return{idMapString:y,indexesToUse:a,key:t}}}return null}async setQuery(t,s){const e=[],n=new Set,i=new Set(Array.from(this.$fullnameUppercase_ID.keys()));t.forEach(a=>{a.forEach((c,m)=>{const x=c.expression.filter(d=>d.operator!=="In");x.length===0&&c.type==="Boundingbox"&&x.push({});const _=c.expression.filter(d=>d.operator==="In");_.length&&_.forEach(d=>{d.input.trim().split(`
`).forEach(z=>x.push({input:z,operator:"Equal"}))}),x.forEach(d=>{const f=new Set,z=new Set,T=m===0?"Append":c.filtertype;let A=i;if(T==="Keep"&&(A=new Set(Array.from(n)),n.clear()),c.type==="Standard"&&d.operator==="Equal"){const g=d.input.toUpperCase();A.has(d.input.toUpperCase())&&(T!=="Remove"?this.addChildrenToSet(f,g):this.addChildrenToSet(z,g))}else A.forEach(g=>{var yt;const Z=(yt=d.input)==null?void 0:yt.toUpperCase(),I=g.toUpperCase();if(c.type==="Standard")switch(d.operator){case"Equal":console.error("this should not be triggered anymore");break;case"Contains":I.includes(Z)&&(T!=="Remove"?this.addChildrenToSet(f,I):this.addChildrenToSet(z,I));break}else{const Et=new J(new p(c.min.x,c.min.y,c.min.z),new p(c.max.x,c.max.y,c.max.z)),P=this.$fullNameUppercaseBoundingbox[I];if(P){const Ct=new J(new p(P.x,P.y,P.z),new p(P.X,P.Y,P.Z));Et.intersectsBox(Ct)&&(T!=="Remove"?(this.addChildrenToSet(f,I),this.getParentsFromName(I).forEach(D=>f.add(D==null?void 0:D.toUpperCase()))):(this.addChildrenToSet(z,I),this.getParentsFromName(I).forEach(D=>z.add(D==null?void 0:D.toUpperCase()))))}}});f.forEach(g=>n.add(g)),z.forEach(g=>n.delete(g))})});const y=new Set(n);e.push(y)});const r=new Set;t.length===0&&i.forEach(a=>r.add(a)),e.forEach(a=>{a.forEach(y=>r.add(y))});const h=new Map;let l="";{const a=Array.from(r),y=new Set(a.map(c=>c.toUpperCase()));s.forEach(c=>{if(c.name===""){l=c.color;return}if(c.operator==="Equal"){const m=c.name.toUpperCase();if(y.has(c.name.toUpperCase())){const x=new Set;x.add(m),this.addChildrenToSet(x,m),x.forEach(_=>{h.set(_.toUpperCase(),c.color)})}}if(c.operator==="In"){const m=[];c.name.trim().split(`
`).forEach(_=>{const[d,f]=_.split("	");m.push([d,f])}),m.forEach(([_,d])=>{if(y.has(_.toUpperCase())){const f=new Set;f.add(_.toUpperCase()),this.addChildrenToSet(f,_.toUpperCase()),f.forEach(z=>{h.set(z.toUpperCase(),d)})}})}c.operator==="Contains"&&a.forEach(m=>{if(m.toUpperCase().includes(c.name.toUpperCase())){h.set(m,c.color);const x=new Set;x.add(m.toUpperCase()),this.addChildrenToSet(x,m.toUpperCase()),x.forEach(_=>{h.set(_.toUpperCase(),c.color)})}})})}return Array.from(r).map(a=>{const y=this.$fullnameUppercase_ID.get(a.toUpperCase()),c=h.get(a.toUpperCase());return[y||"",c||l]})}addChildrenToSet(t,s){var n;const e=this.$fullnameUppercase_ID.get(s==null?void 0:s.toUpperCase());if(e){s&&t.add(s==null?void 0:s.toUpperCase());const i=(n=this.$allIds.get(e))==null?void 0:n[2];Array.isArray(i)&&i.forEach(r=>{var a,y;const h=(a=this.$allIds.get(r))==null?void 0:a[0];h&&t.add(h==null?void 0:h.toUpperCase());const l=c=>{var m,x;for(let _=0;_<c.length;_++){const d=c[_],f=(m=this.$allIds.get(d))==null?void 0:m[0];f&&t.add(f==null?void 0:f.toUpperCase());const z=(x=this.$allIds.get(d))==null?void 0:x[2];Array.isArray(z)&&l(z)}},o=(y=this.$allIds.get(r))==null?void 0:y[2];Array.isArray(o)&&l(o)})}}}W(Mt)})();
