(function(){"use strict";const Q=Symbol("Comlink.proxy"),ot=Symbol("Comlink.endpoint"),lt=Symbol("Comlink.releaseProxy"),F=Symbol("Comlink.thrown"),v=u=>typeof u=="object"&&u!==null||typeof u=="function",ct={canHandle:u=>v(u)&&u[Q],serialize(u){const{port1:t,port2:s}=new MessageChannel;return R(u,t),[s,[s]]},deserialize(u){return u.start(),mt(u)}},yt={canHandle:u=>v(u)&&F in u,serialize({value:u}){let t;return u instanceof Error?t={isError:!0,value:{message:u.message,name:u.name,stack:u.stack}}:t={isError:!1,value:u},[t,[]]},deserialize(u){throw u.isError?Object.assign(new Error(u.value.message),u.value):u.value}},G=new Map([["proxy",ct],["throw",yt]]);function R(u,t=self){t.addEventListener("message",function s(e){if(!e||!e.data)return;const{id:i,type:n,path:r}=Object.assign({path:[]},e.data),h=(e.data.argumentList||[]).map(A);let o;try{const l=r.slice(0,-1).reduce((c,y)=>c[y],u),a=r.reduce((c,y)=>c[y],u);switch(n){case"GET":o=a;break;case"SET":l[r.slice(-1)[0]]=A(e.data.value),o=!0;break;case"APPLY":o=a.apply(l,h);break;case"CONSTRUCT":{const c=new a(...h);o=dt(c)}break;case"ENDPOINT":{const{port1:c,port2:y}=new MessageChannel;R(u,y),o=_t(c,[c])}break;case"RELEASE":o=void 0;break;default:return}}catch(l){o={value:l,[F]:0}}Promise.resolve(o).catch(l=>({value:l,[F]:0})).then(l=>{const[a,c]=H(l);t.postMessage(Object.assign(Object.assign({},a),{id:i}),c),n==="RELEASE"&&(t.removeEventListener("message",s),J(t))})}),t.start&&t.start()}function ut(u){return u.constructor.name==="MessagePort"}function J(u){ut(u)&&u.close()}function mt(u,t){return W(u,[],t)}function L(u){if(u)throw new Error("Proxy has been released and is not useable")}function W(u,t=[],s=function(){}){let e=!1;const i=new Proxy(s,{get(n,r){if(L(e),r===lt)return()=>N(u,{type:"RELEASE",path:t.map(h=>h.toString())}).then(()=>{J(u),e=!0});if(r==="then"){if(t.length===0)return{then:()=>i};const h=N(u,{type:"GET",path:t.map(o=>o.toString())}).then(A);return h.then.bind(h)}return W(u,[...t,r])},set(n,r,h){L(e);const[o,l]=H(h);return N(u,{type:"SET",path:[...t,r].map(a=>a.toString()),value:o},l).then(A)},apply(n,r,h){L(e);const o=t[t.length-1];if(o===ot)return N(u,{type:"ENDPOINT"}).then(A);if(o==="bind")return W(u,t.slice(0,-1));const[l,a]=tt(h);return N(u,{type:"APPLY",path:t.map(c=>c.toString()),argumentList:l},a).then(A)},construct(n,r){L(e);const[h,o]=tt(r);return N(u,{type:"CONSTRUCT",path:t.map(l=>l.toString()),argumentList:h},o).then(A)}});return i}function xt(u){return Array.prototype.concat.apply([],u)}function tt(u){const t=u.map(H);return[t.map(s=>s[0]),xt(t.map(s=>s[1]))]}const st=new WeakMap;function _t(u,t){return st.set(u,t),u}function dt(u){return Object.assign(u,{[Q]:!0})}function H(u){for(const[t,s]of G)if(s.canHandle(u)){const[e,i]=s.serialize(u);return[{type:"HANDLER",name:t,value:e},i]}return[{type:"RAW",value:u},st.get(u)||[]]}function A(u){switch(u.type){case"HANDLER":return G.get(u.name).deserialize(u.value);case"RAW":return u.value}}function N(u,t,s){return new Promise(e=>{const i=pt();u.addEventListener("message",function n(r){!r.data||!r.data.id||r.data.id!==i||(u.removeEventListener("message",n),e(r.data))}),u.start&&u.start(),u.postMessage(Object.assign({id:i},t),s)})}function pt(){return new Array(4).fill(0).map(()=>Math.floor(Math.random()*Number.MAX_SAFE_INTEGER).toString(16)).join("-")}function et(u){if(u)return u.projectKey;throw"getActiveProjectModelGroupKey called without active prosjekt selected"}function ft(u){return`META_${u}`}function it(u){return`BOUDNING_${u}`}class nt{constructor(t,s=1,e="DATA"){this.__name=t,this.__version=s,this.__storeName=e,this.__logEnabled=!1}enableLog(){this.__logEnabled=!0}__logStart(t){this.__logEnabled&&console.time(`ModelStoreLog_${this.__name}_${this.__storeName}_${t}`)}__logEnd(t){this.__logEnabled&&console.timeEnd(`ModelStoreLog_${this.__name}_${this.__storeName}_${t}`)}close(){return new Promise(t=>{this.__db&&(this.__db.close(),t(!0))})}__open(){return new Promise((t,s)=>{if(this.__db)t(this.__db);else{const e=indexedDB.open(this.__name,this.__version);e.onupgradeneeded=()=>{const i=e.result;i.objectStoreNames.contains(this.__name)||i.createObjectStore(this.__storeName)},e.onblocked=i=>{this.__logEnd("getKey"),s({type:"onblocked",event:i})},e.onerror=i=>{this.__logEnd("getKey"),s({type:"onblocked",event:i})},e.onsuccess=()=>{this.__db=e.result,t(e.result)}}})}getUUID(){return crypto.randomUUID()}getKey(t){return new Promise(async(s,e)=>{this.__logStart("getKey");try{const n=(await this.__open()).transaction(this.__storeName);n.onerror=o=>{this.__logEnd("getKey"),e({type:"store tx error",event:o})};const h=n.objectStore(this.__storeName).get(t);h.onsuccess=()=>{this.__logEnd("getKey"),s(h.result)}}catch(i){this.__logEnd("getKey"),e(i)}})}setKey(t,s){return new Promise(async(e,i)=>{var n;this.__logStart("setKey");try{const h=(await this.__open()).transaction(this.__storeName,"readwrite");h.onerror=a=>{this.__logEnd("setKey"),i({type:"store tx error",event:a})};const l=h.objectStore(this.__storeName).put(s,t);l.onsuccess=()=>{this.__logEnd("setKey"),e(l.result)},(n=l.transaction)==null||n.commit()}catch(r){this.__logEnd("setKey"),i(r)}})}getAllKeys(){return new Promise(async(t,s)=>{this.__logStart("getAllKeys");try{const i=(await this.__open()).transaction(this.__storeName,"readwrite");i.onerror=h=>{this.__logEnd("getAllKeys"),s({type:"store tx error",event:h})};const r=i.objectStore(this.__storeName).getAllKeys();r.onsuccess=()=>{this.__logEnd("getAllKeys"),t(r.result)}}catch(e){this.__logEnd("getAllKeys"),s(e)}})}deleteKey(t){return new Promise(async(s,e)=>{this.__logStart("deleteKey");try{const n=(await this.__open()).transaction(this.__storeName,"readwrite");n.onerror=o=>{this.__logEnd("deleteKey"),e({type:"store tx error",event:o})};const h=n.objectStore(this.__storeName).delete(t);h.onsuccess=()=>{this.__logEnd("deleteKey"),s(h.result)}}catch(i){this.__logEnd("deleteKey"),e(i)}})}deleteDB(){return new Promise((t,s)=>{this.__logStart("deleteDB");const e=indexedDB.deleteDatabase(this.__name);e.onsuccess=()=>{this.__logEnd("deleteDB"),t(!0)},e.onerror=i=>{this.__logEnd("deleteDB"),s({type:"onblocked",event:i})}})}}/**
 * @license
 * Copyright 2010-2022 Three.js Authors
 * SPDX-License-Identifier: MIT
 */const rt="143";function ht(u,t,s){return Math.max(t,Math.min(s,u))}class gt{constructor(t=0,s=0,e=0,i=1){this.isQuaternion=!0,this._x=t,this._y=s,this._z=e,this._w=i}static slerpFlat(t,s,e,i,n,r,h){let o=e[i+0],l=e[i+1],a=e[i+2],c=e[i+3];const y=n[r+0],m=n[r+1],x=n[r+2],d=n[r+3];if(h===0){t[s+0]=o,t[s+1]=l,t[s+2]=a,t[s+3]=c;return}if(h===1){t[s+0]=y,t[s+1]=m,t[s+2]=x,t[s+3]=d;return}if(c!==d||o!==y||l!==m||a!==x){let _=1-h;const p=o*y+l*m+a*x+c*d,g=p>=0?1:-1,w=1-p*p;if(w>Number.EPSILON){const z=Math.sqrt(w),j=Math.atan2(z,p*g);_=Math.sin(_*j)/z,h=Math.sin(h*j)/z}const M=h*g;if(o=o*_+y*M,l=l*_+m*M,a=a*_+x*M,c=c*_+d*M,_===1-h){const z=1/Math.sqrt(o*o+l*l+a*a+c*c);o*=z,l*=z,a*=z,c*=z}}t[s]=o,t[s+1]=l,t[s+2]=a,t[s+3]=c}static multiplyQuaternionsFlat(t,s,e,i,n,r){const h=e[i],o=e[i+1],l=e[i+2],a=e[i+3],c=n[r],y=n[r+1],m=n[r+2],x=n[r+3];return t[s]=h*x+a*c+o*m-l*y,t[s+1]=o*x+a*y+l*c-h*m,t[s+2]=l*x+a*m+h*y-o*c,t[s+3]=a*x-h*c-o*y-l*m,t}get x(){return this._x}set x(t){this._x=t,this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t,this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t,this._onChangeCallback()}get w(){return this._w}set w(t){this._w=t,this._onChangeCallback()}set(t,s,e,i){return this._x=t,this._y=s,this._z=e,this._w=i,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(t){return this._x=t.x,this._y=t.y,this._z=t.z,this._w=t.w,this._onChangeCallback(),this}setFromEuler(t,s){if(!(t&&t.isEuler))throw new Error("THREE.Quaternion: .setFromEuler() now expects an Euler rotation rather than a Vector3 and order.");const e=t._x,i=t._y,n=t._z,r=t._order,h=Math.cos,o=Math.sin,l=h(e/2),a=h(i/2),c=h(n/2),y=o(e/2),m=o(i/2),x=o(n/2);switch(r){case"XYZ":this._x=y*a*c+l*m*x,this._y=l*m*c-y*a*x,this._z=l*a*x+y*m*c,this._w=l*a*c-y*m*x;break;case"YXZ":this._x=y*a*c+l*m*x,this._y=l*m*c-y*a*x,this._z=l*a*x-y*m*c,this._w=l*a*c+y*m*x;break;case"ZXY":this._x=y*a*c-l*m*x,this._y=l*m*c+y*a*x,this._z=l*a*x+y*m*c,this._w=l*a*c-y*m*x;break;case"ZYX":this._x=y*a*c-l*m*x,this._y=l*m*c+y*a*x,this._z=l*a*x-y*m*c,this._w=l*a*c+y*m*x;break;case"YZX":this._x=y*a*c+l*m*x,this._y=l*m*c+y*a*x,this._z=l*a*x-y*m*c,this._w=l*a*c-y*m*x;break;case"XZY":this._x=y*a*c-l*m*x,this._y=l*m*c-y*a*x,this._z=l*a*x+y*m*c,this._w=l*a*c+y*m*x;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+r)}return s!==!1&&this._onChangeCallback(),this}setFromAxisAngle(t,s){const e=s/2,i=Math.sin(e);return this._x=t.x*i,this._y=t.y*i,this._z=t.z*i,this._w=Math.cos(e),this._onChangeCallback(),this}setFromRotationMatrix(t){const s=t.elements,e=s[0],i=s[4],n=s[8],r=s[1],h=s[5],o=s[9],l=s[2],a=s[6],c=s[10],y=e+h+c;if(y>0){const m=.5/Math.sqrt(y+1);this._w=.25/m,this._x=(a-o)*m,this._y=(n-l)*m,this._z=(r-i)*m}else if(e>h&&e>c){const m=2*Math.sqrt(1+e-h-c);this._w=(a-o)/m,this._x=.25*m,this._y=(i+r)/m,this._z=(n+l)/m}else if(h>c){const m=2*Math.sqrt(1+h-e-c);this._w=(n-l)/m,this._x=(i+r)/m,this._y=.25*m,this._z=(o+a)/m}else{const m=2*Math.sqrt(1+c-e-h);this._w=(r-i)/m,this._x=(n+l)/m,this._y=(o+a)/m,this._z=.25*m}return this._onChangeCallback(),this}setFromUnitVectors(t,s){let e=t.dot(s)+1;return e<Number.EPSILON?(e=0,Math.abs(t.x)>Math.abs(t.z)?(this._x=-t.y,this._y=t.x,this._z=0,this._w=e):(this._x=0,this._y=-t.z,this._z=t.y,this._w=e)):(this._x=t.y*s.z-t.z*s.y,this._y=t.z*s.x-t.x*s.z,this._z=t.x*s.y-t.y*s.x,this._w=e),this.normalize()}angleTo(t){return 2*Math.acos(Math.abs(ht(this.dot(t),-1,1)))}rotateTowards(t,s){const e=this.angleTo(t);if(e===0)return this;const i=Math.min(1,s/e);return this.slerp(t,i),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(t){return this._x*t._x+this._y*t._y+this._z*t._z+this._w*t._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let t=this.length();return t===0?(this._x=0,this._y=0,this._z=0,this._w=1):(t=1/t,this._x=this._x*t,this._y=this._y*t,this._z=this._z*t,this._w=this._w*t),this._onChangeCallback(),this}multiply(t){return this.multiplyQuaternions(this,t)}premultiply(t){return this.multiplyQuaternions(t,this)}multiplyQuaternions(t,s){const e=t._x,i=t._y,n=t._z,r=t._w,h=s._x,o=s._y,l=s._z,a=s._w;return this._x=e*a+r*h+i*l-n*o,this._y=i*a+r*o+n*h-e*l,this._z=n*a+r*l+e*o-i*h,this._w=r*a-e*h-i*o-n*l,this._onChangeCallback(),this}slerp(t,s){if(s===0)return this;if(s===1)return this.copy(t);const e=this._x,i=this._y,n=this._z,r=this._w;let h=r*t._w+e*t._x+i*t._y+n*t._z;if(h<0?(this._w=-t._w,this._x=-t._x,this._y=-t._y,this._z=-t._z,h=-h):this.copy(t),h>=1)return this._w=r,this._x=e,this._y=i,this._z=n,this;const o=1-h*h;if(o<=Number.EPSILON){const m=1-s;return this._w=m*r+s*this._w,this._x=m*e+s*this._x,this._y=m*i+s*this._y,this._z=m*n+s*this._z,this.normalize(),this._onChangeCallback(),this}const l=Math.sqrt(o),a=Math.atan2(l,h),c=Math.sin((1-s)*a)/l,y=Math.sin(s*a)/l;return this._w=r*c+this._w*y,this._x=e*c+this._x*y,this._y=i*c+this._y*y,this._z=n*c+this._z*y,this._onChangeCallback(),this}slerpQuaternions(t,s,e){return this.copy(t).slerp(s,e)}random(){const t=Math.random(),s=Math.sqrt(1-t),e=Math.sqrt(t),i=2*Math.PI*Math.random(),n=2*Math.PI*Math.random();return this.set(s*Math.cos(i),e*Math.sin(n),e*Math.cos(n),s*Math.sin(i))}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._w===this._w}fromArray(t,s=0){return this._x=t[s],this._y=t[s+1],this._z=t[s+2],this._w=t[s+3],this._onChangeCallback(),this}toArray(t=[],s=0){return t[s]=this._x,t[s+1]=this._y,t[s+2]=this._z,t[s+3]=this._w,t}fromBufferAttribute(t,s){return this._x=t.getX(s),this._y=t.getY(s),this._z=t.getZ(s),this._w=t.getW(s),this}_onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}class f{constructor(t=0,s=0,e=0){f.prototype.isVector3=!0,this.x=t,this.y=s,this.z=e}set(t,s,e){return e===void 0&&(e=this.z),this.x=t,this.y=s,this.z=e,this}setScalar(t){return this.x=t,this.y=t,this.z=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setZ(t){return this.z=t,this}setComponent(t,s){switch(t){case 0:this.x=s;break;case 1:this.y=s;break;case 2:this.z=s;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this}add(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this}addScalar(t){return this.x+=t,this.y+=t,this.z+=t,this}addVectors(t,s){return this.x=t.x+s.x,this.y=t.y+s.y,this.z=t.z+s.z,this}addScaledVector(t,s){return this.x+=t.x*s,this.y+=t.y*s,this.z+=t.z*s,this}sub(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this}subScalar(t){return this.x-=t,this.y-=t,this.z-=t,this}subVectors(t,s){return this.x=t.x-s.x,this.y=t.y-s.y,this.z=t.z-s.z,this}multiply(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this}multiplyScalar(t){return this.x*=t,this.y*=t,this.z*=t,this}multiplyVectors(t,s){return this.x=t.x*s.x,this.y=t.y*s.y,this.z=t.z*s.z,this}applyEuler(t){return this.applyQuaternion(at.setFromEuler(t))}applyAxisAngle(t,s){return this.applyQuaternion(at.setFromAxisAngle(t,s))}applyMatrix3(t){const s=this.x,e=this.y,i=this.z,n=t.elements;return this.x=n[0]*s+n[3]*e+n[6]*i,this.y=n[1]*s+n[4]*e+n[7]*i,this.z=n[2]*s+n[5]*e+n[8]*i,this}applyNormalMatrix(t){return this.applyMatrix3(t).normalize()}applyMatrix4(t){const s=this.x,e=this.y,i=this.z,n=t.elements,r=1/(n[3]*s+n[7]*e+n[11]*i+n[15]);return this.x=(n[0]*s+n[4]*e+n[8]*i+n[12])*r,this.y=(n[1]*s+n[5]*e+n[9]*i+n[13])*r,this.z=(n[2]*s+n[6]*e+n[10]*i+n[14])*r,this}applyQuaternion(t){const s=this.x,e=this.y,i=this.z,n=t.x,r=t.y,h=t.z,o=t.w,l=o*s+r*i-h*e,a=o*e+h*s-n*i,c=o*i+n*e-r*s,y=-n*s-r*e-h*i;return this.x=l*o+y*-n+a*-h-c*-r,this.y=a*o+y*-r+c*-n-l*-h,this.z=c*o+y*-h+l*-r-a*-n,this}project(t){return this.applyMatrix4(t.matrixWorldInverse).applyMatrix4(t.projectionMatrix)}unproject(t){return this.applyMatrix4(t.projectionMatrixInverse).applyMatrix4(t.matrixWorld)}transformDirection(t){const s=this.x,e=this.y,i=this.z,n=t.elements;return this.x=n[0]*s+n[4]*e+n[8]*i,this.y=n[1]*s+n[5]*e+n[9]*i,this.z=n[2]*s+n[6]*e+n[10]*i,this.normalize()}divide(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this}divideScalar(t){return this.multiplyScalar(1/t)}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this}clamp(t,s){return this.x=Math.max(t.x,Math.min(s.x,this.x)),this.y=Math.max(t.y,Math.min(s.y,this.y)),this.z=Math.max(t.z,Math.min(s.z,this.z)),this}clampScalar(t,s){return this.x=Math.max(t,Math.min(s,this.x)),this.y=Math.max(t,Math.min(s,this.y)),this.z=Math.max(t,Math.min(s,this.z)),this}clampLength(t,s){const e=this.length();return this.divideScalar(e||1).multiplyScalar(Math.max(t,Math.min(s,e)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,s){return this.x+=(t.x-this.x)*s,this.y+=(t.y-this.y)*s,this.z+=(t.z-this.z)*s,this}lerpVectors(t,s,e){return this.x=t.x+(s.x-t.x)*e,this.y=t.y+(s.y-t.y)*e,this.z=t.z+(s.z-t.z)*e,this}cross(t){return this.crossVectors(this,t)}crossVectors(t,s){const e=t.x,i=t.y,n=t.z,r=s.x,h=s.y,o=s.z;return this.x=i*o-n*h,this.y=n*r-e*o,this.z=e*h-i*r,this}projectOnVector(t){const s=t.lengthSq();if(s===0)return this.set(0,0,0);const e=t.dot(this)/s;return this.copy(t).multiplyScalar(e)}projectOnPlane(t){return Y.copy(this).projectOnVector(t),this.sub(Y)}reflect(t){return this.sub(Y.copy(t).multiplyScalar(2*this.dot(t)))}angleTo(t){const s=Math.sqrt(this.lengthSq()*t.lengthSq());if(s===0)return Math.PI/2;const e=this.dot(t)/s;return Math.acos(ht(e,-1,1))}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){const s=this.x-t.x,e=this.y-t.y,i=this.z-t.z;return s*s+e*e+i*i}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)+Math.abs(this.z-t.z)}setFromSpherical(t){return this.setFromSphericalCoords(t.radius,t.phi,t.theta)}setFromSphericalCoords(t,s,e){const i=Math.sin(s)*t;return this.x=i*Math.sin(e),this.y=Math.cos(s)*t,this.z=i*Math.cos(e),this}setFromCylindrical(t){return this.setFromCylindricalCoords(t.radius,t.theta,t.y)}setFromCylindricalCoords(t,s,e){return this.x=t*Math.sin(s),this.y=e,this.z=t*Math.cos(s),this}setFromMatrixPosition(t){const s=t.elements;return this.x=s[12],this.y=s[13],this.z=s[14],this}setFromMatrixScale(t){const s=this.setFromMatrixColumn(t,0).length(),e=this.setFromMatrixColumn(t,1).length(),i=this.setFromMatrixColumn(t,2).length();return this.x=s,this.y=e,this.z=i,this}setFromMatrixColumn(t,s){return this.fromArray(t.elements,s*4)}setFromMatrix3Column(t,s){return this.fromArray(t.elements,s*3)}setFromEuler(t){return this.x=t._x,this.y=t._y,this.z=t._z,this}equals(t){return t.x===this.x&&t.y===this.y&&t.z===this.z}fromArray(t,s=0){return this.x=t[s],this.y=t[s+1],this.z=t[s+2],this}toArray(t=[],s=0){return t[s]=this.x,t[s+1]=this.y,t[s+2]=this.z,t}fromBufferAttribute(t,s){return this.x=t.getX(s),this.y=t.getY(s),this.z=t.getZ(s),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const t=(Math.random()-.5)*2,s=Math.random()*Math.PI*2,e=Math.sqrt(1-t**2);return this.x=e*Math.cos(s),this.y=e*Math.sin(s),this.z=t,this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const Y=new f,at=new gt;class O{constructor(t=new f(1/0,1/0,1/0),s=new f(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=t,this.max=s}set(t,s){return this.min.copy(t),this.max.copy(s),this}setFromArray(t){let s=1/0,e=1/0,i=1/0,n=-1/0,r=-1/0,h=-1/0;for(let o=0,l=t.length;o<l;o+=3){const a=t[o],c=t[o+1],y=t[o+2];a<s&&(s=a),c<e&&(e=c),y<i&&(i=y),a>n&&(n=a),c>r&&(r=c),y>h&&(h=y)}return this.min.set(s,e,i),this.max.set(n,r,h),this}setFromBufferAttribute(t){let s=1/0,e=1/0,i=1/0,n=-1/0,r=-1/0,h=-1/0;for(let o=0,l=t.count;o<l;o++){const a=t.getX(o),c=t.getY(o),y=t.getZ(o);a<s&&(s=a),c<e&&(e=c),y<i&&(i=y),a>n&&(n=a),c>r&&(r=c),y>h&&(h=y)}return this.min.set(s,e,i),this.max.set(n,r,h),this}setFromPoints(t){this.makeEmpty();for(let s=0,e=t.length;s<e;s++)this.expandByPoint(t[s]);return this}setFromCenterAndSize(t,s){const e=$.copy(s).multiplyScalar(.5);return this.min.copy(t).sub(e),this.max.copy(t).add(e),this}setFromObject(t,s=!1){return this.makeEmpty(),this.expandByObject(t,s)}clone(){return new this.constructor().copy(this)}copy(t){return this.min.copy(t.min),this.max.copy(t.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(t){return this.isEmpty()?t.set(0,0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(t){return this.isEmpty()?t.set(0,0,0):t.subVectors(this.max,this.min)}expandByPoint(t){return this.min.min(t),this.max.max(t),this}expandByVector(t){return this.min.sub(t),this.max.add(t),this}expandByScalar(t){return this.min.addScalar(-t),this.max.addScalar(t),this}expandByObject(t,s=!1){t.updateWorldMatrix(!1,!1);const e=t.geometry;if(e!==void 0)if(s&&e.attributes!=null&&e.attributes.position!==void 0){const n=e.attributes.position;for(let r=0,h=n.count;r<h;r++)$.fromBufferAttribute(n,r).applyMatrix4(t.matrixWorld),this.expandByPoint($)}else e.boundingBox===null&&e.computeBoundingBox(),X.copy(e.boundingBox),X.applyMatrix4(t.matrixWorld),this.union(X);const i=t.children;for(let n=0,r=i.length;n<r;n++)this.expandByObject(i[n],s);return this}containsPoint(t){return!(t.x<this.min.x||t.x>this.max.x||t.y<this.min.y||t.y>this.max.y||t.z<this.min.z||t.z>this.max.z)}containsBox(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y&&this.min.z<=t.min.z&&t.max.z<=this.max.z}getParameter(t,s){return s.set((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y),(t.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(t){return!(t.max.x<this.min.x||t.min.x>this.max.x||t.max.y<this.min.y||t.min.y>this.max.y||t.max.z<this.min.z||t.min.z>this.max.z)}intersectsSphere(t){return this.clampPoint(t.center,$),$.distanceToSquared(t.center)<=t.radius*t.radius}intersectsPlane(t){let s,e;return t.normal.x>0?(s=t.normal.x*this.min.x,e=t.normal.x*this.max.x):(s=t.normal.x*this.max.x,e=t.normal.x*this.min.x),t.normal.y>0?(s+=t.normal.y*this.min.y,e+=t.normal.y*this.max.y):(s+=t.normal.y*this.max.y,e+=t.normal.y*this.min.y),t.normal.z>0?(s+=t.normal.z*this.min.z,e+=t.normal.z*this.max.z):(s+=t.normal.z*this.max.z,e+=t.normal.z*this.min.z),s<=-t.constant&&e>=-t.constant}intersectsTriangle(t){if(this.isEmpty())return!1;this.getCenter(B),q.subVectors(this.max,B),T.subVectors(t.a,B),K.subVectors(t.b,B),D.subVectors(t.c,B),b.subVectors(K,T),S.subVectors(D,K),k.subVectors(T,D);let s=[0,-b.z,b.y,0,-S.z,S.y,0,-k.z,k.y,b.z,0,-b.x,S.z,0,-S.x,k.z,0,-k.x,-b.y,b.x,0,-S.y,S.x,0,-k.y,k.x,0];return!Z(s,T,K,D,q)||(s=[1,0,0,0,1,0,0,0,1],!Z(s,T,K,D,q))?!1:(V.crossVectors(b,S),s=[V.x,V.y,V.z],Z(s,T,K,D,q))}clampPoint(t,s){return s.copy(t).clamp(this.min,this.max)}distanceToPoint(t){return $.copy(t).clamp(this.min,this.max).sub(t).length()}getBoundingSphere(t){return this.getCenter(t.center),t.radius=this.getSize($).length()*.5,t}intersect(t){return this.min.max(t.min),this.max.min(t.max),this.isEmpty()&&this.makeEmpty(),this}union(t){return this.min.min(t.min),this.max.max(t.max),this}applyMatrix4(t){return this.isEmpty()?this:(E[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(t),E[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(t),E[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(t),E[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(t),E[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(t),E[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(t),E[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(t),E[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(t),this.setFromPoints(E),this)}translate(t){return this.min.add(t),this.max.add(t),this}equals(t){return t.min.equals(this.min)&&t.max.equals(this.max)}}const E=[new f,new f,new f,new f,new f,new f,new f,new f],$=new f,X=new O,T=new f,K=new f,D=new f,b=new f,S=new f,k=new f,B=new f,q=new f,V=new f,I=new f;function Z(u,t,s,e,i){for(let n=0,r=u.length-3;n<=r;n+=3){I.fromArray(u,n);const h=i.x*Math.abs(I.x)+i.y*Math.abs(I.y)+i.z*Math.abs(I.z),o=t.dot(I),l=s.dot(I),a=e.dot(I);if(Math.max(-Math.max(o,l,a),Math.min(o,l,a))>h)return!1}return!0}typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:rt}})),typeof window<"u"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=rt);class zt{constructor(){this.$full=new Map,this.$data={},this.$fullnameUppercase=new Map,this.$lvl1={},this.$lvl2={},this.$rows=[],this.$boundingboxes={}}async filterFullname(t,s=0){const e=Array.from(this.$fullnameUppercase.keys());let i=t.toUpperCase();if(!t)return[[],0];let n=!1;t[0]==="*"&&(n=!0);let r=!1;if(t[t.length-1]==="*"&&(r=!0),i.split("*").filter(l=>l!=="").length>1)return[["WILDCARD ONLY SUPPORTED IN THE START/END"],0];i=i.replaceAll("*","");const o=[];for(let l=s;l<e.length;l++){const a=e[l]||"";switch(!0){case(n&&r):a.includes(i)&&o.push(a);break;case n:a.endsWith(i)&&o.push(a);break;case r:a.startsWith(i)&&o.push(a);break;default:a===i&&o.push(a)}if(o.length>4)return[o,l]}return[o,0]}async updateMeta(t,s){const e=t==null?void 0:t.filter(n=>n.synced),i=new nt(et(s));if(e!=null&&e.length){const n=e.map(r=>r.name);for(let r=0;r<n.length;r++){const h=await i.getKey(ft(n[r])),o=await i.getKey(it(n[r]));if(o?Object.keys(o).forEach(a=>{this.$boundingboxes[a.toUpperCase()]=o[a]}):console.log(it(n[r]),"missing"),h){const l=new Map;Object.keys(h).forEach(c=>{l.set(c,h[c]),this.$full.set(c,h[c])}),this.traverseMeta(l,n[r])}}}}async removeKeys(t){t.forEach(s=>{var i;const e=(i=this.$full.get(s))==null?void 0:i[1];if(e){const n=this.$full.get(e);if(Array.isArray(n)){const r=n[2],h=r.indexOf(s);h!==-1&&(r.splice(h,1),n[2]=r)}}})}async getKeyChildrenFromItem(t){const s=[],e=this.getDataInternal(t);if(Array.isArray(e)){const i=e[2];i&&s.push(...i);const n=(r,h)=>{Array.isArray(r)&&r.forEach(o=>{const l=this.getDataInternal(o);if(l){const a=l[2];a&&s.push(...a);const c=l[2];n(c)}})};n(i,this.$rows)}return s}async clear(){this.$data={},this.$full=new Map,this.$lvl2={},this.$rows=[],this.$lvl1={}}traverseMeta(t,s){let e=!0,i="";t.forEach(([n,r],h)=>{r==="*"&&(e=!1,this.$data[h]=t,this.$lvl1[n]={lvl1Name:s,id:h},this.$fullnameUppercase.set(n.toUpperCase(),h),i=h)}),t.forEach(([n,r],h)=>{if(r!=="*"){r===i&&(this.$lvl2[n]={lvl2Name:n,id:h}),this.$fullnameUppercase.set(n.toUpperCase(),h);const o=t.get(r);if(o){const l=o[2]||[];l.push(h),o.length===2&&(o.push(l),o.push(!1))}}}),e&&console.log("toplevel missing",t)}async length(){return this.$rows.length}async collaseAll(){const t=async e=>{if(Array.isArray(e))for(let i=0;i<e.length;i++){const n=e[i],r=this.getDataInternal(n);Array.isArray(r)&&(r[3]=!1,await t(r[2]))}},s=Object.keys(this.$data);for(let e=0;e<s.length;e++){const i=s[e],n=this.getDataInternal(i);n&&(n[3]=!1,await t(n[2]))}}updateLvl2(){const t=Object.keys(this.$data),s=[];t.forEach(e=>{const n=this.$data[e].get(e);n&&s.push({key:e,name:n[0]})}),s.forEach(e=>{const i=e.key,n=0,r=this.$data[i],h=r.get(i);if(this.$rows.push({key:i,lvl:n}),Array.isArray(h)){let o=function(a,c,y){if(Array.isArray(a)){const m=y+1;a.forEach(x=>{c.push({key:x,lvl:m});const d=r.get(x);if(d){const _=d[2];d[3]&&o(_,c,m)}})}};const l=h[2];o(l,this.$rows,n)}})}async resetRows(){const t=Object.keys(this.$data),s=[];t.forEach(e=>{const n=this.$data[e].get(e);n&&s.push({key:e,name:n[0]})}),s.sort((e,i)=>e.name<i.name?-1:1),this.$rows=[],s.forEach(e=>{const i=e.key,n=0,r=this.$data[i],h=r.get(i);if(this.$rows.push({key:i,lvl:n}),Array.isArray(h)){let o=function(c,y,m){if(Array.isArray(c)){const x=m+1;c.forEach(d=>{y.push({key:d,lvl:x});const _=r.get(d);if(_){const p=_[2];_[3]&&o(p,y,x)}})}};const l=h[2];h[3]&&o(l,this.$rows,n)}})}async getIDFromFullName(t){return this.$fullnameUppercase.get(t.toUpperCase())}async getRowsWithfullname(){const t=[];return this.$rows.forEach(s=>{const e=this.getDataInternal(s.key);t.push({key:s.key,lvl:s.lvl,data:e})}),t}async getData(t){return this.$full.get(t)}async getDataExt(t){const s=this.$full.get(t);if(Array.isArray(s)){const e=this.getParentsFromName(s[0]);return{fullname:s[0],key:t,parents:e}}else return{fullname:void 0,parents:void 0,key:t}}getDataInternal(t){return this.$full.get(t)}async toggelExpand(t){const s=this.$full.get(t);if(s){const e=s[3];e!==void 0&&(s[3]=!e,await this.resetRows())}}async expandLevelsFromID(t){if(t){let s=["",t,[],!1];for(;s&&s[1]!=="*"&&(s=this.getDataInternal(s[1]),!!s);)s[3]=!0;await this.resetRows()}}getParentsFromName(t){const s=this.$fullnameUppercase.get(t.toUpperCase()),e=new Set;if(s){let i=["",s,[],!1];for(;i&&i[1]!=="*"&&(i=this.getDataInternal(i[1]),!!i);)e.add(i[0])}return Array.from(e)}async getLvl1FromID(t){if(t){let s=["x",t,[],!1];if(s){for(;s&&s[1]!=="*";)s=this.getDataInternal(s[1]);if(s)return this.$lvl1[s[0]].lvl1Name}}}getLvl1FromIDInternal(t){if(t){let s=["x",t,[],!1];for(;s&&s[1]!=="*";)s=this.getDataInternal(s[1]);if(s)return this.$lvl1[s[0]].lvl1Name}}async getSelectionObjectFromKey(t,s,e){const i=this.getLvl1FromIDInternal(t);if(Array.isArray(s)&&i&&e){const n=s.filter(r=>r.name===i&&r.$loaded)[0];if(n){const r=et(e),h=new nt(r),o=await h.getKey(n.name);let l=null,a=null,c=null;if(Array.isArray(o))for(let y=0;y<o.length;y++){const m=o[y],x=await h.getKey(m);if(x!=null&&x.id_sequence&&(l=x.id_sequence[t],l)){a=x.id_sequence[t],c=x.IdMapString;break}}return{idMapString:c,indexesToUse:a,key:t}}}return null}async setQuery(t,s){const e=[],i=new Set,n=new Set(Array.from(this.$fullnameUppercase.keys()));t.forEach(a=>{a.forEach((y,m)=>{const x=y.expression.filter(_=>_.operator!=="In");x.length===0&&y.type==="Boundingbox"&&x.push({});const d=y.expression.filter(_=>_.operator==="In");d.length&&d.forEach(_=>{_.input.trim().split(`
`).forEach(g=>x.push({input:g,operator:"Equal"}))}),x.forEach(_=>{const p=new Set,g=new Set,w=m===0?"Append":y.filtertype;let M=n;if(w==="Keep"&&(M=new Set(Array.from(i)),i.clear()),y.type==="Standard"&&_.operator==="Equal"){const z=_.input.toUpperCase();M.has(_.input.toUpperCase())&&(w!=="Remove"?this.addChildrenToSet(p,z):this.addChildrenToSet(g,z))}else M.forEach(z=>{const j=_.input.toUpperCase(),C=z.toUpperCase();if(y.type==="Standard")switch(_.operator){case"Equal":console.error("this should not be triggered anymore");break;case"Contains":C.includes(j)&&(w!=="Remove"?this.addChildrenToSet(p,C):this.addChildrenToSet(g,C));break}else{const wt=new O(new f(y.min.x,y.min.y,y.min.z),new f(y.max.x,y.max.y,y.max.z)),P=this.$boundingboxes[C];if(P){const Mt=new O(new f(P.min.x,P.min.y,P.min.z),new f(P.max.x,P.max.y,P.max.z));wt.intersectsBox(Mt)&&(w!=="Remove"?(this.addChildrenToSet(p,C),this.getParentsFromName(C).forEach(U=>p.add(U==null?void 0:U.toUpperCase()))):(this.addChildrenToSet(g,C),this.getParentsFromName(C).forEach(U=>g.add(U==null?void 0:U.toUpperCase()))))}}});p.forEach(z=>i.add(z)),g.forEach(z=>i.delete(z))})});const c=new Set(i);e.push(c)});const r=new Set;e.forEach(a=>{a.forEach(c=>r.add(c))});const h=new Map;let o="";{const a=Object.keys(this.$lvl1),c=Object.keys(this.$lvl2),y=Array.from(r).concat(c).concat(a),m=new Set(y.map(x=>x.toUpperCase()));s.forEach(x=>{if(x.name===""){o=x.color;return}if(x.operator==="Equal"){const d=x.name.toUpperCase();if(m.has(x.name.toUpperCase())){const _=new Set;_.add(d),this.addChildrenToSet(_,d),_.forEach(p=>{h.set(p.toUpperCase(),x.color)})}}if(x.operator==="In"){const d=[];x.name.trim().split(`
`).forEach(p=>{const[g,w]=p.split("	");d.push([g,w])}),d.forEach(([p,g])=>{if(m.has(p.toUpperCase())){const w=new Set;w.add(p.toUpperCase()),this.addChildrenToSet(w,p.toUpperCase()),w.forEach(M=>{h.set(M.toUpperCase(),g)})}})}x.operator==="Contains"&&y.forEach(d=>{if(d.toUpperCase().includes(x.name.toUpperCase())){h.set(d,x.color);const _=new Set;_.add(d.toUpperCase()),this.addChildrenToSet(_,d.toUpperCase()),_.forEach(p=>{h.set(p.toUpperCase(),x.color)})}})})}return Array.from(r).map(a=>{const c=this.$fullnameUppercase.get(a.toUpperCase()),y=h.get(a.toUpperCase());return[c||"",y||o]})}addChildrenToSet(t,s){var i;const e=this.$fullnameUppercase.get(s==null?void 0:s.toUpperCase());if(e){s&&t.add(s==null?void 0:s.toUpperCase());const n=(i=this.$full.get(e))==null?void 0:i[2];Array.isArray(n)&&n.forEach(r=>{var a,c;const h=(a=this.$full.get(r))==null?void 0:a[0];h&&t.add(h==null?void 0:h.toUpperCase());const o=y=>{var m,x;for(let d=0;d<y.length;d++){const _=y[d],p=(m=this.$full.get(_))==null?void 0:m[0];p&&t.add(p==null?void 0:p.toUpperCase());const g=(x=this.$full.get(_))==null?void 0:x[2];Array.isArray(g)&&o(g)}},l=(c=this.$full.get(r))==null?void 0:c[2];Array.isArray(l)&&o(l)})}}}R(zt)})();
