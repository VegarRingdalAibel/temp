var St=Object.defineProperty;var Ct=(C,b,I)=>b in C?St(C,b,{enumerable:!0,configurable:!0,writable:!0,value:I}):C[b]=I;var M=(C,b,I)=>(Ct(C,typeof b!="symbol"?b+"":b,I),I);(function(){"use strict";const C=Symbol("Comlink.proxy"),b=Symbol("Comlink.endpoint"),I=Symbol("Comlink.releaseProxy"),Y=Symbol("Comlink.thrown"),st=m=>typeof m=="object"&&m!==null||typeof m=="function",yt={canHandle:m=>st(m)&&m[C],serialize(m){const{port1:t,port2:s}=new MessageChannel;return X(m,t),[s,[s]]},deserialize(m){return m.start(),xt(m)}},mt={canHandle:m=>st(m)&&Y in m,serialize({value:m}){let t;return m instanceof Error?t={isError:!0,value:{message:m.message,name:m.name,stack:m.stack}}:t={isError:!1,value:m},[t,[]]},deserialize(m){throw m.isError?Object.assign(new Error(m.value.message),m.value):m.value}},et=new Map([["proxy",yt],["throw",mt]]);function X(m,t=self){t.addEventListener("message",function s(e){if(!e||!e.data)return;const{id:n,type:i,path:r}=Object.assign({path:[]},e.data),a=(e.data.argumentList||[]).map(T);let l;try{const o=r.slice(0,-1).reduce((c,y)=>c[y],m),h=r.reduce((c,y)=>c[y],m);switch(i){case"GET":l=h;break;case"SET":o[r.slice(-1)[0]]=T(e.data.value),l=!0;break;case"APPLY":l=h.apply(o,a);break;case"CONSTRUCT":{const c=new h(...a);l=pt(c)}break;case"ENDPOINT":{const{port1:c,port2:y}=new MessageChannel;X(m,y),l=dt(c,[c])}break;case"RELEASE":l=void 0;break;default:return}}catch(o){l={value:o,[Y]:0}}Promise.resolve(l).catch(o=>({value:o,[Y]:0})).then(o=>{const[h,c]=O(o);t.postMessage(Object.assign(Object.assign({},h),{id:n}),c),i==="RELEASE"&&(t.removeEventListener("message",s),it(t))})}),t.start&&t.start()}function ut(m){return m.constructor.name==="MessagePort"}function it(m){ut(m)&&m.close()}function xt(m,t){return Z(m,[],t)}function j(m){if(m)throw new Error("Proxy has been released and is not useable")}function Z(m,t=[],s=function(){}){let e=!1;const n=new Proxy(s,{get(i,r){if(j(e),r===I)return()=>B(m,{type:"RELEASE",path:t.map(a=>a.toString())}).then(()=>{it(m),e=!0});if(r==="then"){if(t.length===0)return{then:()=>n};const a=B(m,{type:"GET",path:t.map(l=>l.toString())}).then(T);return a.then.bind(a)}return Z(m,[...t,r])},set(i,r,a){j(e);const[l,o]=O(a);return B(m,{type:"SET",path:[...t,r].map(h=>h.toString()),value:l},o).then(T)},apply(i,r,a){j(e);const l=t[t.length-1];if(l===b)return B(m,{type:"ENDPOINT"}).then(T);if(l==="bind")return Z(m,t.slice(0,-1));const[o,h]=nt(a);return B(m,{type:"APPLY",path:t.map(c=>c.toString()),argumentList:o},h).then(T)},construct(i,r){j(e);const[a,l]=nt(r);return B(m,{type:"CONSTRUCT",path:t.map(o=>o.toString()),argumentList:a},l).then(T)}});return n}function _t(m){return Array.prototype.concat.apply([],m)}function nt(m){const t=m.map(O);return[t.map(s=>s[0]),_t(t.map(s=>s[1]))]}const rt=new WeakMap;function dt(m,t){return rt.set(m,t),m}function pt(m){return Object.assign(m,{[C]:!0})}function O(m){for(const[t,s]of et)if(s.canHandle(m)){const[e,n]=s.serialize(m);return[{type:"HANDLER",name:t,value:e},n]}return[{type:"RAW",value:m},rt.get(m)||[]]}function T(m){switch(m.type){case"HANDLER":return et.get(m.name).deserialize(m.value);case"RAW":return m.value}}function B(m,t,s){return new Promise(e=>{const n=ft();m.addEventListener("message",function i(r){!r.data||!r.data.id||r.data.id!==n||(m.removeEventListener("message",i),e(r.data))}),m.start&&m.start(),m.postMessage(Object.assign({id:n},t),s)})}function ft(){return new Array(4).fill(0).map(()=>Math.floor(Math.random()*Number.MAX_SAFE_INTEGER).toString(16)).join("-")}function at(m){if(m)return m.projectKey;throw"getActiveProjectModelGroupKey called without active prosjekt selected"}function ht(m){return`META_${m}`}class Q{constructor(t,s=1,e="DATA"){M(this,"__name");M(this,"__version");M(this,"__storeName");M(this,"__logEnabled");M(this,"__db");this.__name=t,this.__version=s,this.__storeName=e,this.__logEnabled=!1}enableLog(){this.__logEnabled=!0}__logStart(t){this.__logEnabled&&console.time(`ModelStoreLog_${this.__name}_${this.__storeName}_${t}`)}__logEnd(t){this.__logEnabled&&console.timeEnd(`ModelStoreLog_${this.__name}_${this.__storeName}_${t}`)}close(){return new Promise(t=>{this.__db&&(this.__db.close(),t(!0))})}__open(){return new Promise((t,s)=>{if(this.__db)t(this.__db);else{const e=indexedDB.open(this.__name,this.__version);e.onupgradeneeded=()=>{const n=e.result;n.objectStoreNames.contains(this.__name)||n.createObjectStore(this.__storeName)},e.onblocked=n=>{this.__logEnd("getKey"),s({type:"onblocked",event:n})},e.onerror=n=>{this.__logEnd("getKey"),s({type:"onblocked",event:n})},e.onsuccess=()=>{this.__db=e.result,t(e.result)}}})}getUUID(){return crypto.randomUUID()}getKey(t){return new Promise(async(s,e)=>{this.__logStart("getKey");try{const i=(await this.__open()).transaction(this.__storeName);i.onerror=l=>{this.__logEnd("getKey"),e({type:"store tx error",event:l})};const a=i.objectStore(this.__storeName).get(t);a.onsuccess=()=>{this.__logEnd("getKey"),s(a.result)}}catch(n){this.__logEnd("getKey"),e(n)}})}setKey(t,s){return new Promise(async(e,n)=>{var i;this.__logStart("setKey");try{const a=(await this.__open()).transaction(this.__storeName,"readwrite");a.onerror=h=>{this.__logEnd("setKey"),n({type:"store tx error",event:h})};const o=a.objectStore(this.__storeName).put(s,t);o.onsuccess=()=>{this.__logEnd("setKey"),e(o.result)},(i=o.transaction)==null||i.commit()}catch(r){this.__logEnd("setKey"),n(r)}})}getAllKeys(){return new Promise(async(t,s)=>{this.__logStart("getAllKeys");try{const n=(await this.__open()).transaction(this.__storeName,"readwrite");n.onerror=a=>{this.__logEnd("getAllKeys"),s({type:"store tx error",event:a})};const r=n.objectStore(this.__storeName).getAllKeys();r.onsuccess=()=>{this.__logEnd("getAllKeys"),t(r.result)}}catch(e){this.__logEnd("getAllKeys"),s(e)}})}deleteKey(t){return new Promise(async(s,e)=>{this.__logStart("deleteKey");try{const i=(await this.__open()).transaction(this.__storeName,"readwrite");i.onerror=l=>{this.__logEnd("deleteKey"),e({type:"store tx error",event:l})};const a=i.objectStore(this.__storeName).delete(t);a.onsuccess=()=>{this.__logEnd("deleteKey"),s(a.result)}}catch(n){this.__logEnd("deleteKey"),e(n)}})}deleteDB(){return new Promise((t,s)=>{this.__logStart("deleteDB");const e=indexedDB.deleteDatabase(this.__name);e.onsuccess=()=>{this.__logEnd("deleteDB"),t(!0)},e.onerror=n=>{this.__logEnd("deleteDB"),s({type:"onblocked",event:n})}})}}/**
 * @license
 * Copyright 2010-2022 Three.js Authors
 * SPDX-License-Identifier: MIT
 */const ot="144";function lt(m,t,s){return Math.max(t,Math.min(s,m))}class gt{constructor(t=0,s=0,e=0,n=1){this.isQuaternion=!0,this._x=t,this._y=s,this._z=e,this._w=n}static slerpFlat(t,s,e,n,i,r,a){let l=e[n+0],o=e[n+1],h=e[n+2],c=e[n+3];const y=i[r+0],u=i[r+1],x=i[r+2],d=i[r+3];if(a===0){t[s+0]=l,t[s+1]=o,t[s+2]=h,t[s+3]=c;return}if(a===1){t[s+0]=y,t[s+1]=u,t[s+2]=x,t[s+3]=d;return}if(c!==d||l!==y||o!==u||h!==x){let _=1-a;const p=l*y+o*u+h*x+c*d,g=p>=0?1:-1,w=1-p*p;if(w>Number.EPSILON){const z=Math.sqrt(w),H=Math.atan2(z,p*g);_=Math.sin(_*H)/z,a=Math.sin(a*H)/z}const E=a*g;if(l=l*_+y*E,o=o*_+u*E,h=h*_+x*E,c=c*_+d*E,_===1-a){const z=1/Math.sqrt(l*l+o*o+h*h+c*c);l*=z,o*=z,h*=z,c*=z}}t[s]=l,t[s+1]=o,t[s+2]=h,t[s+3]=c}static multiplyQuaternionsFlat(t,s,e,n,i,r){const a=e[n],l=e[n+1],o=e[n+2],h=e[n+3],c=i[r],y=i[r+1],u=i[r+2],x=i[r+3];return t[s]=a*x+h*c+l*u-o*y,t[s+1]=l*x+h*y+o*c-a*u,t[s+2]=o*x+h*u+a*y-l*c,t[s+3]=h*x-a*c-l*y-o*u,t}get x(){return this._x}set x(t){this._x=t,this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t,this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t,this._onChangeCallback()}get w(){return this._w}set w(t){this._w=t,this._onChangeCallback()}set(t,s,e,n){return this._x=t,this._y=s,this._z=e,this._w=n,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(t){return this._x=t.x,this._y=t.y,this._z=t.z,this._w=t.w,this._onChangeCallback(),this}setFromEuler(t,s){const e=t._x,n=t._y,i=t._z,r=t._order,a=Math.cos,l=Math.sin,o=a(e/2),h=a(n/2),c=a(i/2),y=l(e/2),u=l(n/2),x=l(i/2);switch(r){case"XYZ":this._x=y*h*c+o*u*x,this._y=o*u*c-y*h*x,this._z=o*h*x+y*u*c,this._w=o*h*c-y*u*x;break;case"YXZ":this._x=y*h*c+o*u*x,this._y=o*u*c-y*h*x,this._z=o*h*x-y*u*c,this._w=o*h*c+y*u*x;break;case"ZXY":this._x=y*h*c-o*u*x,this._y=o*u*c+y*h*x,this._z=o*h*x+y*u*c,this._w=o*h*c-y*u*x;break;case"ZYX":this._x=y*h*c-o*u*x,this._y=o*u*c+y*h*x,this._z=o*h*x-y*u*c,this._w=o*h*c+y*u*x;break;case"YZX":this._x=y*h*c+o*u*x,this._y=o*u*c+y*h*x,this._z=o*h*x-y*u*c,this._w=o*h*c-y*u*x;break;case"XZY":this._x=y*h*c-o*u*x,this._y=o*u*c-y*h*x,this._z=o*h*x+y*u*c,this._w=o*h*c+y*u*x;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+r)}return s!==!1&&this._onChangeCallback(),this}setFromAxisAngle(t,s){const e=s/2,n=Math.sin(e);return this._x=t.x*n,this._y=t.y*n,this._z=t.z*n,this._w=Math.cos(e),this._onChangeCallback(),this}setFromRotationMatrix(t){const s=t.elements,e=s[0],n=s[4],i=s[8],r=s[1],a=s[5],l=s[9],o=s[2],h=s[6],c=s[10],y=e+a+c;if(y>0){const u=.5/Math.sqrt(y+1);this._w=.25/u,this._x=(h-l)*u,this._y=(i-o)*u,this._z=(r-n)*u}else if(e>a&&e>c){const u=2*Math.sqrt(1+e-a-c);this._w=(h-l)/u,this._x=.25*u,this._y=(n+r)/u,this._z=(i+o)/u}else if(a>c){const u=2*Math.sqrt(1+a-e-c);this._w=(i-o)/u,this._x=(n+r)/u,this._y=.25*u,this._z=(l+h)/u}else{const u=2*Math.sqrt(1+c-e-a);this._w=(r-n)/u,this._x=(i+o)/u,this._y=(l+h)/u,this._z=.25*u}return this._onChangeCallback(),this}setFromUnitVectors(t,s){let e=t.dot(s)+1;return e<Number.EPSILON?(e=0,Math.abs(t.x)>Math.abs(t.z)?(this._x=-t.y,this._y=t.x,this._z=0,this._w=e):(this._x=0,this._y=-t.z,this._z=t.y,this._w=e)):(this._x=t.y*s.z-t.z*s.y,this._y=t.z*s.x-t.x*s.z,this._z=t.x*s.y-t.y*s.x,this._w=e),this.normalize()}angleTo(t){return 2*Math.acos(Math.abs(lt(this.dot(t),-1,1)))}rotateTowards(t,s){const e=this.angleTo(t);if(e===0)return this;const n=Math.min(1,s/e);return this.slerp(t,n),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(t){return this._x*t._x+this._y*t._y+this._z*t._z+this._w*t._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let t=this.length();return t===0?(this._x=0,this._y=0,this._z=0,this._w=1):(t=1/t,this._x=this._x*t,this._y=this._y*t,this._z=this._z*t,this._w=this._w*t),this._onChangeCallback(),this}multiply(t){return this.multiplyQuaternions(this,t)}premultiply(t){return this.multiplyQuaternions(t,this)}multiplyQuaternions(t,s){const e=t._x,n=t._y,i=t._z,r=t._w,a=s._x,l=s._y,o=s._z,h=s._w;return this._x=e*h+r*a+n*o-i*l,this._y=n*h+r*l+i*a-e*o,this._z=i*h+r*o+e*l-n*a,this._w=r*h-e*a-n*l-i*o,this._onChangeCallback(),this}slerp(t,s){if(s===0)return this;if(s===1)return this.copy(t);const e=this._x,n=this._y,i=this._z,r=this._w;let a=r*t._w+e*t._x+n*t._y+i*t._z;if(a<0?(this._w=-t._w,this._x=-t._x,this._y=-t._y,this._z=-t._z,a=-a):this.copy(t),a>=1)return this._w=r,this._x=e,this._y=n,this._z=i,this;const l=1-a*a;if(l<=Number.EPSILON){const u=1-s;return this._w=u*r+s*this._w,this._x=u*e+s*this._x,this._y=u*n+s*this._y,this._z=u*i+s*this._z,this.normalize(),this._onChangeCallback(),this}const o=Math.sqrt(l),h=Math.atan2(o,a),c=Math.sin((1-s)*h)/o,y=Math.sin(s*h)/o;return this._w=r*c+this._w*y,this._x=e*c+this._x*y,this._y=n*c+this._y*y,this._z=i*c+this._z*y,this._onChangeCallback(),this}slerpQuaternions(t,s,e){return this.copy(t).slerp(s,e)}random(){const t=Math.random(),s=Math.sqrt(1-t),e=Math.sqrt(t),n=2*Math.PI*Math.random(),i=2*Math.PI*Math.random();return this.set(s*Math.cos(n),e*Math.sin(i),e*Math.cos(i),s*Math.sin(n))}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._w===this._w}fromArray(t,s=0){return this._x=t[s],this._y=t[s+1],this._z=t[s+2],this._w=t[s+3],this._onChangeCallback(),this}toArray(t=[],s=0){return t[s]=this._x,t[s+1]=this._y,t[s+2]=this._z,t[s+3]=this._w,t}fromBufferAttribute(t,s){return this._x=t.getX(s),this._y=t.getY(s),this._z=t.getZ(s),this._w=t.getW(s),this}_onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}class f{constructor(t=0,s=0,e=0){f.prototype.isVector3=!0,this.x=t,this.y=s,this.z=e}set(t,s,e){return e===void 0&&(e=this.z),this.x=t,this.y=s,this.z=e,this}setScalar(t){return this.x=t,this.y=t,this.z=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setZ(t){return this.z=t,this}setComponent(t,s){switch(t){case 0:this.x=s;break;case 1:this.y=s;break;case 2:this.z=s;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this}add(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this}addScalar(t){return this.x+=t,this.y+=t,this.z+=t,this}addVectors(t,s){return this.x=t.x+s.x,this.y=t.y+s.y,this.z=t.z+s.z,this}addScaledVector(t,s){return this.x+=t.x*s,this.y+=t.y*s,this.z+=t.z*s,this}sub(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this}subScalar(t){return this.x-=t,this.y-=t,this.z-=t,this}subVectors(t,s){return this.x=t.x-s.x,this.y=t.y-s.y,this.z=t.z-s.z,this}multiply(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this}multiplyScalar(t){return this.x*=t,this.y*=t,this.z*=t,this}multiplyVectors(t,s){return this.x=t.x*s.x,this.y=t.y*s.y,this.z=t.z*s.z,this}applyEuler(t){return this.applyQuaternion(ct.setFromEuler(t))}applyAxisAngle(t,s){return this.applyQuaternion(ct.setFromAxisAngle(t,s))}applyMatrix3(t){const s=this.x,e=this.y,n=this.z,i=t.elements;return this.x=i[0]*s+i[3]*e+i[6]*n,this.y=i[1]*s+i[4]*e+i[7]*n,this.z=i[2]*s+i[5]*e+i[8]*n,this}applyNormalMatrix(t){return this.applyMatrix3(t).normalize()}applyMatrix4(t){const s=this.x,e=this.y,n=this.z,i=t.elements,r=1/(i[3]*s+i[7]*e+i[11]*n+i[15]);return this.x=(i[0]*s+i[4]*e+i[8]*n+i[12])*r,this.y=(i[1]*s+i[5]*e+i[9]*n+i[13])*r,this.z=(i[2]*s+i[6]*e+i[10]*n+i[14])*r,this}applyQuaternion(t){const s=this.x,e=this.y,n=this.z,i=t.x,r=t.y,a=t.z,l=t.w,o=l*s+r*n-a*e,h=l*e+a*s-i*n,c=l*n+i*e-r*s,y=-i*s-r*e-a*n;return this.x=o*l+y*-i+h*-a-c*-r,this.y=h*l+y*-r+c*-i-o*-a,this.z=c*l+y*-a+o*-r-h*-i,this}project(t){return this.applyMatrix4(t.matrixWorldInverse).applyMatrix4(t.projectionMatrix)}unproject(t){return this.applyMatrix4(t.projectionMatrixInverse).applyMatrix4(t.matrixWorld)}transformDirection(t){const s=this.x,e=this.y,n=this.z,i=t.elements;return this.x=i[0]*s+i[4]*e+i[8]*n,this.y=i[1]*s+i[5]*e+i[9]*n,this.z=i[2]*s+i[6]*e+i[10]*n,this.normalize()}divide(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this}divideScalar(t){return this.multiplyScalar(1/t)}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this}clamp(t,s){return this.x=Math.max(t.x,Math.min(s.x,this.x)),this.y=Math.max(t.y,Math.min(s.y,this.y)),this.z=Math.max(t.z,Math.min(s.z,this.z)),this}clampScalar(t,s){return this.x=Math.max(t,Math.min(s,this.x)),this.y=Math.max(t,Math.min(s,this.y)),this.z=Math.max(t,Math.min(s,this.z)),this}clampLength(t,s){const e=this.length();return this.divideScalar(e||1).multiplyScalar(Math.max(t,Math.min(s,e)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,s){return this.x+=(t.x-this.x)*s,this.y+=(t.y-this.y)*s,this.z+=(t.z-this.z)*s,this}lerpVectors(t,s,e){return this.x=t.x+(s.x-t.x)*e,this.y=t.y+(s.y-t.y)*e,this.z=t.z+(s.z-t.z)*e,this}cross(t){return this.crossVectors(this,t)}crossVectors(t,s){const e=t.x,n=t.y,i=t.z,r=s.x,a=s.y,l=s.z;return this.x=n*l-i*a,this.y=i*r-e*l,this.z=e*a-n*r,this}projectOnVector(t){const s=t.lengthSq();if(s===0)return this.set(0,0,0);const e=t.dot(this)/s;return this.copy(t).multiplyScalar(e)}projectOnPlane(t){return v.copy(this).projectOnVector(t),this.sub(v)}reflect(t){return this.sub(v.copy(t).multiplyScalar(2*this.dot(t)))}angleTo(t){const s=Math.sqrt(this.lengthSq()*t.lengthSq());if(s===0)return Math.PI/2;const e=this.dot(t)/s;return Math.acos(lt(e,-1,1))}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){const s=this.x-t.x,e=this.y-t.y,n=this.z-t.z;return s*s+e*e+n*n}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)+Math.abs(this.z-t.z)}setFromSpherical(t){return this.setFromSphericalCoords(t.radius,t.phi,t.theta)}setFromSphericalCoords(t,s,e){const n=Math.sin(s)*t;return this.x=n*Math.sin(e),this.y=Math.cos(s)*t,this.z=n*Math.cos(e),this}setFromCylindrical(t){return this.setFromCylindricalCoords(t.radius,t.theta,t.y)}setFromCylindricalCoords(t,s,e){return this.x=t*Math.sin(s),this.y=e,this.z=t*Math.cos(s),this}setFromMatrixPosition(t){const s=t.elements;return this.x=s[12],this.y=s[13],this.z=s[14],this}setFromMatrixScale(t){const s=this.setFromMatrixColumn(t,0).length(),e=this.setFromMatrixColumn(t,1).length(),n=this.setFromMatrixColumn(t,2).length();return this.x=s,this.y=e,this.z=n,this}setFromMatrixColumn(t,s){return this.fromArray(t.elements,s*4)}setFromMatrix3Column(t,s){return this.fromArray(t.elements,s*3)}setFromEuler(t){return this.x=t._x,this.y=t._y,this.z=t._z,this}equals(t){return t.x===this.x&&t.y===this.y&&t.z===this.z}fromArray(t,s=0){return this.x=t[s],this.y=t[s+1],this.z=t[s+2],this}toArray(t=[],s=0){return t[s]=this.x,t[s+1]=this.y,t[s+2]=this.z,t}fromBufferAttribute(t,s){return this.x=t.getX(s),this.y=t.getY(s),this.z=t.getZ(s),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const t=(Math.random()-.5)*2,s=Math.random()*Math.PI*2,e=Math.sqrt(1-t**2);return this.x=e*Math.cos(s),this.y=e*Math.sin(s),this.z=t,this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const v=new f,ct=new gt;class G{constructor(t=new f(1/0,1/0,1/0),s=new f(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=t,this.max=s}set(t,s){return this.min.copy(t),this.max.copy(s),this}setFromArray(t){let s=1/0,e=1/0,n=1/0,i=-1/0,r=-1/0,a=-1/0;for(let l=0,o=t.length;l<o;l+=3){const h=t[l],c=t[l+1],y=t[l+2];h<s&&(s=h),c<e&&(e=c),y<n&&(n=y),h>i&&(i=h),c>r&&(r=c),y>a&&(a=y)}return this.min.set(s,e,n),this.max.set(i,r,a),this}setFromBufferAttribute(t){let s=1/0,e=1/0,n=1/0,i=-1/0,r=-1/0,a=-1/0;for(let l=0,o=t.count;l<o;l++){const h=t.getX(l),c=t.getY(l),y=t.getZ(l);h<s&&(s=h),c<e&&(e=c),y<n&&(n=y),h>i&&(i=h),c>r&&(r=c),y>a&&(a=y)}return this.min.set(s,e,n),this.max.set(i,r,a),this}setFromPoints(t){this.makeEmpty();for(let s=0,e=t.length;s<e;s++)this.expandByPoint(t[s]);return this}setFromCenterAndSize(t,s){const e=N.copy(s).multiplyScalar(.5);return this.min.copy(t).sub(e),this.max.copy(t).add(e),this}setFromObject(t,s=!1){return this.makeEmpty(),this.expandByObject(t,s)}clone(){return new this.constructor().copy(this)}copy(t){return this.min.copy(t.min),this.max.copy(t.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(t){return this.isEmpty()?t.set(0,0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(t){return this.isEmpty()?t.set(0,0,0):t.subVectors(this.max,this.min)}expandByPoint(t){return this.min.min(t),this.max.max(t),this}expandByVector(t){return this.min.sub(t),this.max.add(t),this}expandByScalar(t){return this.min.addScalar(-t),this.max.addScalar(t),this}expandByObject(t,s=!1){t.updateWorldMatrix(!1,!1);const e=t.geometry;if(e!==void 0)if(s&&e.attributes!=null&&e.attributes.position!==void 0){const i=e.attributes.position;for(let r=0,a=i.count;r<a;r++)N.fromBufferAttribute(i,r).applyMatrix4(t.matrixWorld),this.expandByPoint(N)}else e.boundingBox===null&&e.computeBoundingBox(),J.copy(e.boundingBox),J.applyMatrix4(t.matrixWorld),this.union(J);const n=t.children;for(let i=0,r=n.length;i<r;i++)this.expandByObject(n[i],s);return this}containsPoint(t){return!(t.x<this.min.x||t.x>this.max.x||t.y<this.min.y||t.y>this.max.y||t.z<this.min.z||t.z>this.max.z)}containsBox(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y&&this.min.z<=t.min.z&&t.max.z<=this.max.z}getParameter(t,s){return s.set((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y),(t.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(t){return!(t.max.x<this.min.x||t.min.x>this.max.x||t.max.y<this.min.y||t.min.y>this.max.y||t.max.z<this.min.z||t.min.z>this.max.z)}intersectsSphere(t){return this.clampPoint(t.center,N),N.distanceToSquared(t.center)<=t.radius*t.radius}intersectsPlane(t){let s,e;return t.normal.x>0?(s=t.normal.x*this.min.x,e=t.normal.x*this.max.x):(s=t.normal.x*this.max.x,e=t.normal.x*this.min.x),t.normal.y>0?(s+=t.normal.y*this.min.y,e+=t.normal.y*this.max.y):(s+=t.normal.y*this.max.y,e+=t.normal.y*this.min.y),t.normal.z>0?(s+=t.normal.z*this.min.z,e+=t.normal.z*this.max.z):(s+=t.normal.z*this.max.z,e+=t.normal.z*this.min.z),s<=-t.constant&&e>=-t.constant}intersectsTriangle(t){if(this.isEmpty())return!1;this.getCenter(F),R.subVectors(this.max,F),L.subVectors(t.a,F),q.subVectors(t.b,F),V.subVectors(t.c,F),A.subVectors(q,L),$.subVectors(V,q),P.subVectors(L,V);let s=[0,-A.z,A.y,0,-$.z,$.y,0,-P.z,P.y,A.z,0,-A.x,$.z,0,-$.x,P.z,0,-P.x,-A.y,A.x,0,-$.y,$.x,0,-P.y,P.x,0];return!tt(s,L,q,V,R)||(s=[1,0,0,0,1,0,0,0,1],!tt(s,L,q,V,R))?!1:(W.crossVectors(A,$),s=[W.x,W.y,W.z],tt(s,L,q,V,R))}clampPoint(t,s){return s.copy(t).clamp(this.min,this.max)}distanceToPoint(t){return N.copy(t).clamp(this.min,this.max).sub(t).length()}getBoundingSphere(t){return this.getCenter(t.center),t.radius=this.getSize(N).length()*.5,t}intersect(t){return this.min.max(t.min),this.max.min(t.max),this.isEmpty()&&this.makeEmpty(),this}union(t){return this.min.min(t.min),this.max.max(t.max),this}applyMatrix4(t){return this.isEmpty()?this:(S[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(t),S[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(t),S[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(t),S[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(t),S[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(t),S[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(t),S[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(t),S[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(t),this.setFromPoints(S),this)}translate(t){return this.min.add(t),this.max.add(t),this}equals(t){return t.min.equals(this.min)&&t.max.equals(this.max)}}const S=[new f,new f,new f,new f,new f,new f,new f,new f],N=new f,J=new G,L=new f,q=new f,V=new f,A=new f,$=new f,P=new f,F=new f,R=new f,W=new f,U=new f;function tt(m,t,s,e,n){for(let i=0,r=m.length-3;i<=r;i+=3){U.fromArray(m,i);const a=n.x*Math.abs(U.x)+n.y*Math.abs(U.y)+n.z*Math.abs(U.z),l=t.dot(U),o=s.dot(U),h=e.dot(U);if(Math.max(-Math.max(l,o,h),Math.min(l,o,h))>a)return!1}return!0}typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:ot}})),typeof window<"u"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=ot);function zt(m){return((m==null?void 0:m.projectKey)||"unknown")+"_TEMP"}class wt{constructor(){M(this,"$full",new Map);M(this,"$data",{});M(this,"$fullnameUppercase",new Map);M(this,"$lvl1",{});M(this,"$lvl2",{});M(this,"$rows",[]);M(this,"$boundingboxes",{})}async filterFullname(t,s=0){const e=Array.from(this.$fullnameUppercase.keys());let n=t.toUpperCase();if(!t)return[[],0];let i=!1;t[0]==="*"&&(i=!0);let r=!1;if(t[t.length-1]==="*"&&(r=!0),n.split("*").filter(o=>o!=="").length>1)return[["WILDCARD ONLY SUPPORTED IN THE START/END"],0];n=n.replaceAll("*","");const l=[];for(let o=s;o<e.length;o++){const h=e[o]||"";switch(!0){case(i&&r):h.includes(n)&&l.push(h);break;case i:h.endsWith(n)&&l.push(h);break;case r:h.startsWith(n)&&l.push(h);break;default:h===n&&l.push(h)}if(l.length>4)return[l,o]}return[l,0]}async getBoundingBoxFromName(t){const s=new Set;this.addChildrenToSet(s,t);const e={};return s.forEach(n=>{const i=this.$boundingboxes[n];i&&(e!=null&&e.max||(e.max=i.max,e.min=i.min),e.max.x<i.max.x&&(e.max.x=i.max.x),e.max.y<i.max.y&&(e.max.y=i.max.y),e.max.z<i.max.z&&(e.max.z=i.max.z),e.min.x>i.min.x&&(e.min.x=i.min.x),e.min.y>i.min.y&&(e.min.y=i.min.y),e.min.z>i.min.z&&(e.min.z=i.min.z))}),e}async getBoundingBoxFromKeys(t){const s=new Set;t.forEach(n=>{var i;return s.add(((i=this.$full.get(n))==null?void 0:i[0])||"not found...")});const e={};return s.forEach(n=>{const i=this.$boundingboxes[n.toUpperCase()];i&&(e!=null&&e.max||(e.max=i.max,e.min=i.min),e.max.x<i.max.x&&(e.max.x=i.max.x),e.max.y<i.max.y&&(e.max.y=i.max.y),e.max.z<i.max.z&&(e.max.z=i.max.z),e.min.x>i.min.x&&(e.min.x=i.min.x),e.min.y>i.min.y&&(e.min.y=i.min.y),e.min.z>i.min.z&&(e.min.z=i.min.z))}),e}async updateMeta(t,s){const e=t==null?void 0:t.filter(i=>i.synced),n=new Q(at(s));if(e!=null&&e.length){const i=e.map(o=>o.name),r=new Q(zt(s)),a=await r.getKey("dataStoreMetaData")||new Map,l=a.size>0;for(let o=0;o<i.length;o++){let h;l?h=a.get(i[o]):(h=await n.getKey(ht(i[o])),a.set(i[o],structuredClone(h)));const c=h.meta,y=h.bbox;if(y?Object.keys(y).forEach(x=>{this.$boundingboxes[x.toUpperCase()]=y[x]}):console.log(ht(i[o]),"missing"),c){const u=new Map;Object.keys(c).forEach(d=>{u.set(d,c[d]),this.$full.set(d,c[d])}),this.traverseMeta(u,i[o])}}l||await r.setKey("dataStoreMetaData",a)}}async removeKeys(t){t.forEach(s=>{var n;const e=(n=this.$full.get(s))==null?void 0:n[1];if(e){const i=this.$full.get(e);if(Array.isArray(i)){const r=i[2],a=r.indexOf(s);a!==-1&&(r.splice(a,1),i[2]=r)}}})}async getKeyChildrenFromItem(t){const s=[],e=this.getDataInternal(t);if(Array.isArray(e)){const n=e[2];n&&s.push(...n);const i=(r,a)=>{Array.isArray(r)&&r.forEach(l=>{const o=this.getDataInternal(l);if(o){const h=o[2];h&&s.push(...h);const c=o[2];i(c)}})};i(n,this.$rows)}return s}async clear(){this.$data={},this.$full=new Map,this.$lvl2={},this.$rows=[],this.$lvl1={}}traverseMeta(t,s){let e=!0,n="";t.forEach(([i,r],a)=>{r==="*"&&(e=!1,this.$data[a]=t,this.$lvl1[i]={lvl1Name:s,id:a},this.$fullnameUppercase.set(i.toUpperCase(),a),n=a)}),t.forEach(([i,r],a)=>{if(r!=="*"){r===n&&(this.$lvl2[i]={lvl2Name:i,id:a}),this.$fullnameUppercase.set(i.toUpperCase(),a);const l=t.get(r);if(l){const o=l[2]||[];o.push(a),l.length===2&&(l.push(o),l.push(!1))}}}),e&&console.log("toplevel missing",t)}async length(){return this.$rows.length}async collaseAll(){const t=async e=>{if(Array.isArray(e))for(let n=0;n<e.length;n++){const i=e[n],r=this.getDataInternal(i);Array.isArray(r)&&(r[3]=!1,await t(r[2]))}},s=Object.keys(this.$data);for(let e=0;e<s.length;e++){const n=s[e],i=this.getDataInternal(n);i&&(i[3]=!1,await t(i[2]))}}updateLvl2(){const t=Object.keys(this.$data),s=[];t.forEach(e=>{const i=this.$data[e].get(e);i&&s.push({key:e,name:i[0]})}),s.forEach(e=>{const n=e.key,i=0,r=this.$data[n],a=r.get(n);if(this.$rows.push({key:n,lvl:i}),Array.isArray(a)){let l=function(h,c,y){if(Array.isArray(h)){const u=y+1;h.forEach(x=>{c.push({key:x,lvl:u});const d=r.get(x);if(d){const _=d[2];d[3]&&l(_,c,u)}})}};const o=a[2];l(o,this.$rows,i)}})}async resetRows(){const t=Object.keys(this.$data),s=[];t.forEach(e=>{const i=this.$data[e].get(e);i&&s.push({key:e,name:i[0]})}),s.sort((e,n)=>e.name<n.name?-1:1),this.$rows=[],s.forEach(e=>{const n=e.key,i=0,r=this.$data[n],a=r.get(n);if(this.$rows.push({key:n,lvl:i}),Array.isArray(a)){let l=function(c,y,u){if(Array.isArray(c)){const x=u+1;c.forEach(d=>{y.push({key:d,lvl:x});const _=r.get(d);if(_){const p=_[2];_[3]&&l(p,y,x)}})}};const o=a[2];a[3]&&l(o,this.$rows,i)}})}async getIDFromFullName(t){return this.$fullnameUppercase.get(t.toUpperCase())}async getRowsWithfullname(){const t=[];return this.$rows.forEach(s=>{const e=this.getDataInternal(s.key);t.push({key:s.key,lvl:s.lvl,data:e})}),t}async getData(t){return this.$full.get(t)}async getDataExt(t){const s=this.$full.get(t);if(Array.isArray(s)){const e=this.getParentsFromName(s[0]);return{fullname:s[0],key:t,parents:e}}else return{fullname:void 0,parents:void 0,key:t}}getDataInternal(t){return this.$full.get(t)}async toggelExpand(t){const s=this.$full.get(t);if(s){const e=s[3];e!==void 0&&(s[3]=!e,await this.resetRows())}}async expandLevelsFromID(t){if(t){let s=["",t,[],!1];for(;s&&s[1]!=="*"&&(s=this.getDataInternal(s[1]),!!s);)s[3]=!0;await this.resetRows()}}getParentsFromName(t){const s=this.$fullnameUppercase.get(t.toUpperCase()),e=new Set;if(s){let n=["",s,[],!1];for(;n&&n[1]!=="*"&&(n=this.getDataInternal(n[1]),!!n);)e.add(n[0])}return Array.from(e)}async getLvl1FromID(t){if(t){let s=["x",t,[],!1];if(s){for(;s&&s[1]!=="*";)s=this.getDataInternal(s[1]);if(s)return this.$lvl1[s[0]].lvl1Name}}}getLvl1FromIDInternal(t){if(t){let s=["x",t,[],!1];for(;s&&s[1]!=="*";)s=this.getDataInternal(s[1]);if(s)return this.$lvl1[s[0]].lvl1Name}}async getSelectionObjectFromKey(t,s,e){const n=this.getLvl1FromIDInternal(t);if(Array.isArray(s)&&n&&e){const i=s.filter(r=>r.name===n&&r.$loaded)[0];if(i){const r=at(e),a=new Q(r),l=await a.getKey(i.name);let o=null,h=null,c=null;if(Array.isArray(l))for(let y=0;y<l.length;y++){const u=l[y],x=await a.getKey(u);if(x!=null&&x.id_sequence&&(o=x.id_sequence[t],o)){h=x.id_sequence[t],c=x.IdMapString;break}}return{idMapString:c,indexesToUse:h,key:t}}}return null}async setQuery(t,s){const e=[],n=new Set,i=new Set(Array.from(this.$fullnameUppercase.keys()));t.forEach(h=>{h.forEach((y,u)=>{const x=y.expression.filter(_=>_.operator!=="In");x.length===0&&y.type==="Boundingbox"&&x.push({});const d=y.expression.filter(_=>_.operator==="In");d.length&&d.forEach(_=>{_.input.trim().split(`
`).forEach(g=>x.push({input:g,operator:"Equal"}))}),x.forEach(_=>{const p=new Set,g=new Set,w=u===0?"Append":y.filtertype;let E=i;if(w==="Keep"&&(E=new Set(Array.from(n)),n.clear()),y.type==="Standard"&&_.operator==="Equal"){const z=_.input.toUpperCase();E.has(_.input.toUpperCase())&&(w!=="Remove"?this.addChildrenToSet(p,z):this.addChildrenToSet(g,z))}else E.forEach(z=>{const H=_.input.toUpperCase(),k=z.toUpperCase();if(y.type==="Standard")switch(_.operator){case"Equal":console.error("this should not be triggered anymore");break;case"Contains":k.includes(H)&&(w!=="Remove"?this.addChildrenToSet(p,k):this.addChildrenToSet(g,k));break}else{const Mt=new G(new f(y.min.x,y.min.y,y.min.z),new f(y.max.x,y.max.y,y.max.z)),K=this.$boundingboxes[k];if(K){const Et=new G(new f(K.min.x,K.min.y,K.min.z),new f(K.max.x,K.max.y,K.max.z));Mt.intersectsBox(Et)&&(w!=="Remove"?(this.addChildrenToSet(p,k),this.getParentsFromName(k).forEach(D=>p.add(D==null?void 0:D.toUpperCase()))):(this.addChildrenToSet(g,k),this.getParentsFromName(k).forEach(D=>g.add(D==null?void 0:D.toUpperCase()))))}}});p.forEach(z=>n.add(z)),g.forEach(z=>n.delete(z))})});const c=new Set(n);e.push(c)});const r=new Set;t.length===0&&i.forEach(h=>r.add(h)),e.forEach(h=>{h.forEach(c=>r.add(c))});const a=new Map;let l="";{const h=Object.keys(this.$lvl1),c=Object.keys(this.$lvl2),y=Array.from(r).concat(c).concat(h),u=new Set(y.map(x=>x.toUpperCase()));s.forEach(x=>{if(x.name===""){l=x.color;return}if(x.operator==="Equal"){const d=x.name.toUpperCase();if(u.has(x.name.toUpperCase())){const _=new Set;_.add(d),this.addChildrenToSet(_,d),_.forEach(p=>{a.set(p.toUpperCase(),x.color)})}}if(x.operator==="In"){const d=[];x.name.trim().split(`
`).forEach(p=>{const[g,w]=p.split("	");d.push([g,w])}),d.forEach(([p,g])=>{if(u.has(p.toUpperCase())){const w=new Set;w.add(p.toUpperCase()),this.addChildrenToSet(w,p.toUpperCase()),w.forEach(E=>{a.set(E.toUpperCase(),g)})}})}x.operator==="Contains"&&y.forEach(d=>{if(d.toUpperCase().includes(x.name.toUpperCase())){a.set(d,x.color);const _=new Set;_.add(d.toUpperCase()),this.addChildrenToSet(_,d.toUpperCase()),_.forEach(p=>{a.set(p.toUpperCase(),x.color)})}})})}return Array.from(r).map(h=>{const c=this.$fullnameUppercase.get(h.toUpperCase()),y=a.get(h.toUpperCase());return[c||"",y||l]})}addChildrenToSet(t,s){var n;const e=this.$fullnameUppercase.get(s==null?void 0:s.toUpperCase());if(e){s&&t.add(s==null?void 0:s.toUpperCase());const i=(n=this.$full.get(e))==null?void 0:n[2];Array.isArray(i)&&i.forEach(r=>{var h,c;const a=(h=this.$full.get(r))==null?void 0:h[0];a&&t.add(a==null?void 0:a.toUpperCase());const l=y=>{var u,x;for(let d=0;d<y.length;d++){const _=y[d],p=(u=this.$full.get(_))==null?void 0:u[0];p&&t.add(p==null?void 0:p.toUpperCase());const g=(x=this.$full.get(_))==null?void 0:x[2];Array.isArray(g)&&l(g)}},o=(c=this.$full.get(r))==null?void 0:c[2];Array.isArray(o)&&l(o)})}}}X(wt)})();
